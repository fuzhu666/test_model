(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[11],{"033R":function(e,t,s){"use strict";var r=s("TBio");e.exports=function(e){var t=["'use strict'","var CACHED={}"],s=[],n=e.funcName+"_cwise_thunk";t.push(["return function ",n,"(",e.shimArgs.join(","),"){"].join(""));for(var i=[],o=[],a=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],c=[],u=[],h=0;h<e.arrayArgs.length;++h){var l=e.arrayArgs[h];s.push(["t",l,"=array",l,".dtype,","r",l,"=array",l,".order"].join("")),i.push("t"+l),i.push("r"+l),o.push("t"+l),o.push("r"+l+".join()"),a.push("array"+l+".data"),a.push("array"+l+".stride"),a.push("array"+l+".offset|0"),h>0&&(c.push("array"+e.arrayArgs[0]+".shape.length===array"+l+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[h]))),u.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+l+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[h])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+c.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),h=0;h<e.scalarArgs.length;++h)a.push("scalar"+e.scalarArgs[h]);return s.push(["type=[",o.join(","),"].join()"].join("")),s.push("proc=CACHED[type]"),t.push("var "+s.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",a.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(r.bind(void 0,e))}},1:function(e,t){},2:function(e,t){},F16p:function(e,t,s){"use strict";e.exports=function(e,t,s){return 0===e.length?e:t?(s||e.sort(t),function(e,t){for(var s=1,r=e.length,n=e[0],i=e[0],o=1;o<r;++o)if(i=n,t(n=e[o],i)){if(o===s){s++;continue}e[s++]=n}return e.length=s,e}(e,t)):(s||e.sort(),function(e){for(var t=1,s=e.length,r=e[0],n=e[0],i=1;i<s;++i,n=r)if(n=r,(r=e[i])!==n){if(i===t){t++;continue}e[t++]=r}return e.length=t,e}(e))}},IDFI:function(e,t,s){"use strict";e.exports=function(e){for(var t=new Array(e),s=0;s<e;++s)t[s]=s;return t}},Nt23:function(e,t,s){"use strict";s.r(t),function(e){s.d(t,"Accessor",(function(){return L})),s.d(t,"Animation",(function(){return j})),s.d(t,"AnimationChannel",(function(){return k})),s.d(t,"AnimationSampler",(function(){return D})),s.d(t,"AttributeLink",(function(){return z})),s.d(t,"Buffer",(function(){return G})),s.d(t,"BufferUtils",(function(){return E})),s.d(t,"COPY_IDENTITY",(function(){return O})),s.d(t,"Camera",(function(){return B})),s.d(t,"ColorUtils",(function(){return b})),s.d(t,"Document",(function(){return ae})),s.d(t,"Extension",(function(){return ce})),s.d(t,"ExtensionProperty",(function(){return V})),s.d(t,"FileUtils",(function(){return C})),s.d(t,"Format",(function(){return h})),s.d(t,"GLB_BUFFER",(function(){return o})),s.d(t,"Graph",(function(){return g})),s.d(t,"GraphChild",(function(){return d})),s.d(t,"GraphChildList",(function(){return m})),s.d(t,"ImageUtils",(function(){return I})),s.d(t,"IndexLink",(function(){return q})),s.d(t,"Link",(function(){return f})),s.d(t,"Logger",(function(){return v})),s.d(t,"Material",(function(){return Z})),s.d(t,"MathUtils",(function(){return S})),s.d(t,"Mesh",(function(){return Q})),s.d(t,"Node",(function(){return ee})),s.d(t,"NodeIO",(function(){return Ee})),s.d(t,"PlatformIO",(function(){return ye})),s.d(t,"Primitive",(function(){return te})),s.d(t,"PrimitiveTarget",(function(){return se})),s.d(t,"Property",(function(){return U})),s.d(t,"PropertyType",(function(){return a})),s.d(t,"ReaderContext",(function(){return he})),s.d(t,"Root",(function(){return oe})),s.d(t,"Scene",(function(){return re})),s.d(t,"Skin",(function(){return ne})),s.d(t,"Texture",(function(){return ie})),s.d(t,"TextureChannel",(function(){return u})),s.d(t,"TextureInfo",(function(){return X})),s.d(t,"TextureLink",(function(){return H})),s.d(t,"VERSION",(function(){return i})),s.d(t,"VertexLayout",(function(){return c})),s.d(t,"WebIO",(function(){return Ce})),s.d(t,"WriterContext",(function(){return de})),s.d(t,"bounds",(function(){return x})),s.d(t,"uuid",(function(){return M}));var r=s("n+fv"),n=s("ZaHm");const i="v0.12.7",o="@glb.bin";var a,c,u,h,l;function p(e,t,s,r){var n,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i<3?n(o):i>3?n(t,s,o):n(t,s))||o);return i>3&&o&&Object.defineProperty(t,s,o),o}(l=a||(a={})).ACCESSOR="Accessor",l.ANIMATION="Animation",l.ANIMATION_CHANNEL="AnimationChannel",l.ANIMATION_SAMPLER="AnimationSampler",l.BUFFER="Buffer",l.CAMERA="Camera",l.MATERIAL="Material",l.MESH="Mesh",l.PRIMITIVE="Primitive",l.PRIMITIVE_TARGET="PrimitiveTarget",l.NODE="Node",l.ROOT="Root",l.SCENE="Scene",l.SKIN="Skin",l.TEXTURE="Texture",l.TEXTURE_INFO="TextureInfo",function(e){e.INTERLEAVED="interleaved",e.SEPARATE="separate"}(c||(c={})),function(e){e[e.R=4096]="R",e[e.G=256]="G",e[e.B=16]="B",e[e.A=1]="A"}(u||(u={})),function(e){e.GLTF="GLTF",e.GLB="GLB"}(h||(h={}));class f{constructor(e,t,s){if(this.t=void 0,this.i=void 0,this.h=void 0,this.o=!1,this.u=[],this.t=e,this.i=t,this.h=s,!t.canLink(s))throw new Error("Cannot link disconnected graphs/documents.")}getName(){return this.t}getParent(){return this.i}getChild(){return this.h}setChild(e){return this.h=e,this}dispose(){this.o||(this.o=!0,this.u.forEach((e=>e())),this.u.length=0)}onDispose(e){return this.u.push(e),this}isDisposed(){return this.o}}class g{constructor(){this.l=new Set,this.p=new Set,this.g=new Map,this.v=new Map,this.u={}}on(e,t){return this.u[e]=this.u[e]||[],this.u[e].push(t),this}emit(e,t){for(const s of this.u[e]||[])s(t);return this}getLinks(){return Array.from(this.p)}listParentLinks(e){return Array.from(this.v.get(e)||this.l)}listParents(e){return this.listParentLinks(e).map((e=>e.getParent()))}listChildLinks(e){return Array.from(this.g.get(e)||this.l)}listChildren(e){return this.listChildLinks(e).map((e=>e.getChild()))}disconnectChildren(e){return(this.g.get(e)||this.l).forEach((e=>e.dispose())),this}disconnectParents(e,t){let s=Array.from(this.v.get(e)||this.l);return t&&(s=s.filter((e=>t(e.getParent())))),s.forEach((e=>e.dispose())),this}swapChild(e,t,s){const r=this.g.get(e)||this.l;return Array.from(r).filter((e=>e.getChild()===t)).forEach((e=>{this.v.get(t).delete(e),e.setChild(s),this.v.has(s)||this.v.set(s,new Set),this.v.get(s).add(e)})),this}link(e,t,s){if(!s)return null;const r=new f(e,t,s);return this.registerLink(r),r}registerLink(e){this.p.add(e);const t=e.getParent();this.g.has(t)||this.g.set(t,new Set),this.g.get(t).add(e);const s=e.getChild();return this.v.has(s)||this.v.set(s,new Set),this.v.get(s).add(e),e.onDispose((()=>this.unlink(e))),e}unlink(e){return this.p.delete(e),this.g.get(e.getParent()).delete(e),this.v.get(e.getChild()).delete(e),this}}function d(e,t){Object.defineProperty(e,t,{get:function(){return this["__"+t]},set:function(e){const s=this["__"+t];s&&!Array.isArray(s)&&s.dispose(),e&&!Array.isArray(e)&&e.onDispose((()=>{this["__"+t]=null})),this["__"+t]=e},enumerable:!0})}function m(e,t){}function x(e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},s=e.propertyType===a.NODE?[e]:e.listChildren();for(const r of s)r.traverse((e=>{const s=e.getMesh();if(!s)return;const r=T(s,e.getWorldMatrix());y(r.min,t),y(r.max,t)}));return t}function T(e,t){const s={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of e.listPrimitives()){const e=n.getAttribute("POSITION");if(!e)continue;let i=[0,0,0],o=[0,0,0];for(let n=0;n<e.getCount();n++)i=e.getElement(n,i),o=Object(r.b)(o,i,t),y(o,s)}return s}function y(e,t){for(let s=0;s<3;s++)t.min[s]=Math.min(e[s],t.min[s]),t.max[s]=Math.max(e[s],t.max[s])}class E{static createBufferFromDataURI(t){if("undefined"==typeof e){const e=atob(t.split(",")[1]),s=new Uint8Array(e.length);for(let t=0;t<e.length;t++)s[t]=e.charCodeAt(t);return s.buffer}{const s=t.split(",")[1],r=t.indexOf("base64")>=0;return this.trim(e.from(s,r?"base64":"utf8"))}}static encodeText(t){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(t).buffer:this.trim(e.from(t))}static decodeText(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):e.from(t).toString("utf8")}static trim(e){const{byteOffset:t,byteLength:s}=e;return e.buffer.slice(t,t+s)}static concat(e){let t=0;for(const n of e)t+=n.byteLength;const s=new Uint8Array(t);let r=0;for(const n of e)s.set(new Uint8Array(n),r),r+=n.byteLength;return s.buffer}static pad(e,t=0){const s=this.padNumber(e.byteLength);if(s!==e.byteLength){const r=new Uint8Array(s);if(r.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<s;n++)r[n]=t;return r.buffer}return e}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;const s=new DataView(e),r=new DataView(t);let n=e.byteLength;for(;n--;)if(s.getUint8(n)!==r.getUint8(n))return!1;return!0}}class b{static hexToFactor(e,t){e=Math.floor(e);const s=t;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[s,r,n]=this.convertLinearToSRGB(e,t);return 255*s<<16^255*r<<8^255*n<<0}static convertSRGBToLinear(e,t){const s=e,r=t;for(let n=0;n<3;n++)r[n]=s[n]<.04045?.0773993808*s[n]:Math.pow(.9478672986*s[n]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const s=e,r=t;for(let n=0;n<3;n++)r[n]=s[n]<.0031308?12.92*s[n]:1.055*Math.pow(s[n],.41666)-.055;return t}}class C{static basename(e){const t=e.split(/[\\/]/).pop();return t.substr(0,t.lastIndexOf("."))}static extension(e){return 0!==e.indexOf("data:")?e.split(/[\\/]/).pop().split(/[.]/).pop():0===e.indexOf("data:image/png")?"png":0===e.indexOf("data:image/jpeg")?"jpeg":"bin"}}class _{getSize(e){const t=new DataView(e);return E.decodeText(e.slice(12,16))===_.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}_.PNG_FRIED_CHUNK_NAME="CgBI";class I{static registerFormat(e,t){this.impls[e]=t}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getMemSize(e,t){if(!this.impls[t])return null;if(this.impls[t].getGPUByteLength)return this.impls[t].getGPUByteLength(e);let s=0;const r=this.getSize(e,t);if(!r)return null;for(;r[0]>1||r[1]>1;)s+=r[0]*r[1]*4,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return s+=4,s}static mimeTypeToExtension(e){return"image/jpeg"===e?"jpg":e.split("/").pop()}static extensionToMimeType(e){return"jpg"===e?"image/jpeg":`image/${e}`}}function A(e,t){if(t>e.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==e.getUint8(t))throw new TypeError("Invalid JPG, marker table corrupted");return e}I.impls={"image/jpeg":new class{getSize(e){let t,s,r=new DataView(e,4);for(;r.byteLength;){if(t=r.getUint16(0,!1),A(r,t),s=r.getUint8(t+1),192===s||193===s||194===s)return[r.getUint16(t+7,!1),r.getUint16(t+5,!1)];r=new DataView(e,r.byteOffset+t+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}},"image/png":new _};class S{static identity(e){return e}static eq(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-t[s])>1e-5)return!1;return!0}static denormalize(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,t,s,i){let o=Object(r.a)([e[0],e[1],e[2]]);const a=Object(r.a)([e[4],e[5],e[6]]),c=Object(r.a)([e[8],e[9],e[10]]);Object(n.a)(e)<0&&(o=-o),t[0]=e[12],t[1]=e[13],t[2]=e[14];const u=e.slice(),h=1/o,l=1/a,p=1/c;u[0]*=h,u[1]*=h,u[2]*=h,u[4]*=l,u[5]*=l,u[6]*=l,u[8]*=p,u[9]*=p,u[10]*=p,Object(n.b)(s,u),i[0]=o,i[1]=a,i[2]=c}static compose(e,t,s,r){const n=r,i=t[0],o=t[1],a=t[2],c=t[3],u=i+i,h=o+o,l=a+a,p=i*u,f=i*h,g=i*l,d=o*h,m=o*l,x=a*l,T=c*u,y=c*h,E=c*l,b=s[0],C=s[1],_=s[2];return n[0]=(1-(d+x))*b,n[1]=(f+E)*b,n[2]=(g-y)*b,n[3]=0,n[4]=(f-E)*C,n[5]=(1-(p+x))*C,n[6]=(m+T)*C,n[7]=0,n[8]=(g+y)*_,n[9]=(m-T)*_,n[10]=(1-(p+d))*_,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}}class v{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=v.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=v.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=v.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=v.Verbosity.ERROR&&console.error(e)}}v.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},v.DEFAULT_INSTANCE=new v(v.Verbosity.INFO);const N="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",w=new Set,R=function(){let e="";for(let t=0;t<6;t++)e+=N.charAt(Math.floor(Math.random()*N.length));return e},M=function(){for(let e=0;e<999;e++){const e=R();if(!w.has(e))return w.add(e),e}return""},O=e=>e;class U extends class{constructor(e){this.graph=void 0,this.o=!1,this.graph=e,this.graph=e}canLink(e){return this.graph===e.graph}isDisposed(){return this.o}dispose(){this.graph.disconnectChildren(this),this.graph.disconnectParents(this),this.o=!0,this.graph.emit("dispose",this)}detach(){return this.graph.disconnectParents(this),this}swap(e,t){return this.graph.swapChild(this,e,t),this}addGraphChild(e,t){return e.push(t),t.onDispose((()=>{const s=e.filter((e=>e!==t));e.length=0;for(const t of s)e.push(t)})),this}removeGraphChild(e,t){return e.filter((e=>e.getChild()===t)).forEach((e=>e.dispose())),this}clearGraphChildList(e){for(;e.length>0;)e[0].dispose();return this}listGraphParents(){return this.graph.listParents(this)}}{constructor(e,t=""){super(e),this.graph=void 0,this.m={},this.t="",this.graph=e,this.t=t}getName(){return this.t}setName(e){return this.t=e,this}getExtras(){return this.m}setExtras(e){return this.m=e,this}clone(){const e=new(0,this.constructor)(this.graph).copy(this,O);return this.graph.emit("clone",e),e}copy(e,t=O){return this.t=e.t,this.m=JSON.parse(JSON.stringify(e.m)),this}detach(){return this.graph.disconnectParents(this,(e=>"Root"!==e.propertyType)),this}listParents(){return this.listGraphParents()}}const F="Pass extension name (string) as lookup token, not a constructor.";class P extends U{constructor(...e){super(...e),this.extensions=[]}copy(e,t=O){return super.copy(e,t),this.clearGraphChildList(this.extensions),e.extensions.forEach((e=>{const s=e.getChild();this.setExtension(s.extensionName,t(s))})),this}getExtension(e){if("string"!=typeof e)throw new Error(F);const t=this.extensions.find((t=>t.getChild().extensionName===e));return t?t.getChild():null}setExtension(e,t){if("string"!=typeof e)throw new Error(F);const s=this.getExtension(e);return s&&this.removeGraphChild(this.extensions,s),t?(t.T(this),this.addGraphChild(this.extensions,this.graph.link(e,this,t))):this}listExtensions(){return this.extensions.map((e=>e.getChild()))}}p([m],P.prototype,"extensions",void 0);class L extends P{constructor(...e){super(...e),this.propertyType=a.ACCESSOR,this.S=null,this.M=L.Type.SCALAR,this.I=L.ComponentType.FLOAT,this.N=!1,this.C=S.identity,this._=S.identity,this.buffer=null}copy(e,t=O){return super.copy(e,t),this.M=e.M,this.I=e.I,this.N=e.N,this.C=e.C,this._=e._,e.S&&(this.S=e.S.slice()),this.setBuffer(e.buffer?t(e.buffer.getChild()):null),this}static getElementSize(e){switch(e){case L.Type.SCALAR:return 1;case L.Type.VEC2:return 2;case L.Type.VEC3:return 3;case L.Type.VEC4:case L.Type.MAT2:return 4;case L.Type.MAT3:return 9;case L.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case L.ComponentType.BYTE:case L.ComponentType.UNSIGNED_BYTE:return 1;case L.ComponentType.SHORT:case L.ComponentType.UNSIGNED_SHORT:return 2;case L.ComponentType.UNSIGNED_INT:case L.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let s=0;s<t;s++)e[s]=this._(e[s]);return e}getMin(e){const t=this.getCount(),s=this.getElementSize();for(let r=0;r<s;r++)e[r]=1/0;for(let r=0;r<t*s;r+=s)for(let t=0;t<s;t++){const s=this.S[r+t];Number.isFinite(s)&&(e[t]=Math.min(e[t],s))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let s=0;s<t;s++)e[s]=this._(e[s]);return e}getMax(e){const t=this.getCount(),s=this.getElementSize();for(let r=0;r<s;r++)e[r]=-1/0;for(let r=0;r<t*s;r+=s)for(let t=0;t<s;t++){const s=this.S[r+t];Number.isFinite(s)&&(e[t]=Math.max(e[t],s))}return e}getCount(){return this.S?this.S.length/this.getElementSize():0}getType(){return this.M}setType(e){return this.M=e,this}getElementSize(){return L.getElementSize(this.M)}getComponentSize(){return this.S.BYTES_PER_ELEMENT}getComponentType(){return this.I}getNormalized(){return this.N}setNormalized(e){return this.N=e,e?(this._=e=>S.denormalize(e,this.I),this.C=e=>S.normalize(e,this.I)):(this._=S.identity,this.C=S.identity),this}getScalar(e){const t=this.getElementSize();return this._(this.S[e*t])}setScalar(e,t){return this.S[e*this.getElementSize()]=this.C(t),this}getElement(e,t){const s=this.getElementSize();for(let r=0;r<s;r++)t[r]=this._(this.S[e*s+r]);return t}setElement(e,t){const s=this.getElementSize();for(let r=0;r<s;r++)this.S[e*s+r]=this.C(t[r]);return this}getBuffer(){return this.buffer?this.buffer.getChild():null}setBuffer(e){return this.buffer=this.graph.link("buffer",this,e),this}getArray(){return this.S}setArray(e){return this.I=e?function(e){switch(e.constructor){case Float32Array:return L.ComponentType.FLOAT;case Uint32Array:return L.ComponentType.UNSIGNED_INT;case Uint16Array:return L.ComponentType.UNSIGNED_SHORT;case Uint8Array:return L.ComponentType.UNSIGNED_BYTE;case Int16Array:return L.ComponentType.SHORT;case Int8Array:return L.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):L.ComponentType.FLOAT,this.S=e,this}getByteLength(){return this.S?this.S.byteLength:0}}L.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},L.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126},p([d],L.prototype,"buffer",void 0);class j extends P{constructor(...e){super(...e),this.propertyType=a.ANIMATION,this.channels=[],this.samplers=[]}copy(e,t=O){return super.copy(e,t),this.clearGraphChildList(this.channels),this.clearGraphChildList(this.samplers),e.channels.forEach((e=>this.addChannel(t(e.getChild())))),e.samplers.forEach((e=>this.addSampler(t(e.getChild())))),this}addChannel(e){const t=this.graph.link("channel",this,e);return this.addGraphChild(this.channels,t)}removeChannel(e){return this.removeGraphChild(this.channels,e)}listChannels(){return this.channels.map((e=>e.getChild()))}addSampler(e){const t=this.graph.link("sampler",this,e);return this.addGraphChild(this.samplers,t)}removeSampler(e){return this.removeGraphChild(this.samplers,e)}listSamplers(){return this.samplers.map((e=>e.getChild()))}}p([m],j.prototype,"channels",void 0),p([m],j.prototype,"samplers",void 0);class k extends U{constructor(...e){super(...e),this.propertyType=a.ANIMATION_CHANNEL,this.L=null,this.targetNode=null,this.sampler=null}copy(e,t=O){return super.copy(e,t),this.L=e.L,this.setTargetNode(e.targetNode?t(e.targetNode.getChild()):null),this.setSampler(e.sampler?t(e.sampler.getChild()):null),this}getTargetPath(){return this.L}setTargetPath(e){return this.L=e,this}getTargetNode(){return this.targetNode?this.targetNode.getChild():null}setTargetNode(e){return this.targetNode=this.graph.link("target.node",this,e),this}getSampler(){return this.sampler?this.sampler.getChild():null}setSampler(e){return this.sampler=this.graph.link("sampler",this,e),this}}k.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"},p([d],k.prototype,"targetNode",void 0),p([d],k.prototype,"sampler",void 0);class D extends U{constructor(...e){super(...e),this.propertyType=a.ANIMATION_SAMPLER,this.O=D.Interpolation.LINEAR,this.input=null,this.output=null}copy(e,t=O){return super.copy(e,t),this.O=e.O,this.setInput(e.input?t(e.input.getChild()):null),this.setOutput(e.output?t(e.output.getChild()):null),this}getInterpolation(){return this.O}setInterpolation(e){return this.O=e,this}getInput(){return this.input?this.input.getChild():null}setInput(e){return this.input=this.graph.link("input",this,e),this}getOutput(){return this.output?this.output.getChild():null}setOutput(e){return this.output=this.graph.link("output",this,e),this}}D.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"},p([d],D.prototype,"input",void 0),p([d],D.prototype,"output",void 0);class G extends P{constructor(...e){super(...e),this.propertyType=a.BUFFER,this.P=""}copy(e,t=O){return super.copy(e,t),this.P=e.P,this}getURI(){return this.P}setURI(e){return this.P=e,this}}class B extends P{constructor(...e){super(...e),this.propertyType=a.CAMERA,this.M=B.Type.PERSPECTIVE,this.U=.1,this.k=100,this.F=null,this.j=2*Math.PI*50/360,this.D=1,this.J=1}copy(e,t=O){return super.copy(e,t),this.M=e.M,this.U=e.U,this.k=e.k,this.F=e.F,this.j=e.j,this.D=e.D,this.J=e.J,this}getType(){return this.M}setType(e){return this.M=e,this}getZNear(){return this.U}setZNear(e){return this.U=e,this}getZFar(){return this.k}setZFar(e){return this.k=e,this}getAspectRatio(){return this.F}setAspectRatio(e){return this.F=e,this}getYFov(){return this.j}setYFov(e){return this.j=e,this}getXMag(){return this.D}setXMag(e){return this.D=e,this}getYMag(){return this.J}setYMag(e){return this.J=e,this}}B.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class V extends U{constructor(e,t){super(e),this.$=void 0,this.$=t,this.$.addExtensionProperty(this)}dispose(){this.$.removeExtensionProperty(this),super.dispose()}T(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}V.EXTENSION_NAME=void 0;class z extends f{constructor(...e){super(...e),this.semantic=""}copy(e){return this.semantic=e.semantic,this}}class q extends f{copy(e){return this}}class H extends f{constructor(...e){super(...e),this.channels=0}copy(e){return this.channels=e.channels,this}}class $ extends g{linkAttribute(e,t,s){if(!s)return null;const r=new z(e,t,s);return r.semantic=e,this.registerLink(r),r}linkIndex(e,t,s){if(!s)return null;const r=new q(e,t,s);return this.registerLink(r),r}linkTexture(e,t,s,r){if(!r)return null;const n=new H(e,s,r);return n.channels=t,this.registerLink(n),n}}class X extends P{constructor(...e){super(...e),this.propertyType=a.TEXTURE_INFO,this.V=0,this.W=null,this.Y=null,this.H=X.WrapMode.REPEAT,this.q=X.WrapMode.REPEAT}copy(e,t=O){return super.copy(e,t),this.V=e.V,this.W=e.W,this.Y=e.Y,this.H=e.H,this.q=e.q,this}getTexCoord(){return this.V}setTexCoord(e){return this.V=e,this}getMagFilter(){return this.W}setMagFilter(e){return this.W=e,this}getMinFilter(){return this.Y}setMinFilter(e){return this.Y=e,this}getWrapS(){return this.H}setWrapS(e){return this.H=e,this}getWrapT(){return this.q}setWrapT(e){return this.q=e,this}}X.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},X.MagFilter={NEAREST:9728,LINEAR:9729},X.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Y,G:K,B:W,A:J}=u;class Z extends P{constructor(...e){super(...e),this.propertyType=a.MATERIAL,this.Z=Z.AlphaMode.OPAQUE,this.K=.5,this.X=!1,this.tt=[1,1,1,1],this.st=[0,0,0],this.et=1,this.it=1,this.rt=1,this.nt=1,this.baseColorTexture=null,this.baseColorTextureInfo=this.graph.link("baseColorTextureInfo",this,new X(this.graph)),this.emissiveTexture=null,this.emissiveTextureInfo=this.graph.link("emissiveTextureInfo",this,new X(this.graph)),this.normalTexture=null,this.normalTextureInfo=this.graph.link("normalTextureInfo",this,new X(this.graph)),this.occlusionTexture=null,this.occlusionTextureInfo=this.graph.link("occlusionTextureInfo",this,new X(this.graph)),this.metallicRoughnessTexture=null,this.metallicRoughnessTextureInfo=this.graph.link("metallicRoughnessTextureInfo",this,new X(this.graph))}copy(e,t=O){return super.copy(e,t),this.Z=e.Z,this.K=e.K,this.X=e.X,this.tt=[...e.tt],this.st=[...e.st],this.et=e.et,this.it=e.it,this.rt=e.rt,this.nt=e.nt,this.setBaseColorTexture(e.baseColorTexture?t(e.baseColorTexture.getChild()):null),this.baseColorTextureInfo.getChild().copy(t(e.baseColorTextureInfo.getChild()),t),this.setEmissiveTexture(e.emissiveTexture?t(e.emissiveTexture.getChild()):null),this.emissiveTextureInfo.getChild().copy(t(e.emissiveTextureInfo.getChild()),t),this.setNormalTexture(e.normalTexture?t(e.normalTexture.getChild()):null),this.normalTextureInfo.getChild().copy(t(e.normalTextureInfo.getChild()),t),this.setOcclusionTexture(e.occlusionTexture?t(e.occlusionTexture.getChild()):null),this.occlusionTextureInfo.getChild().copy(t(e.occlusionTextureInfo.getChild()),t),this.setMetallicRoughnessTexture(e.metallicRoughnessTexture?t(e.metallicRoughnessTexture.getChild()):null),this.metallicRoughnessTextureInfo.getChild().copy(t(e.metallicRoughnessTextureInfo.getChild()),t),this}dispose(){this.baseColorTextureInfo.getChild().dispose(),this.emissiveTextureInfo.getChild().dispose(),this.normalTextureInfo.getChild().dispose(),this.occlusionTextureInfo.getChild().dispose(),this.metallicRoughnessTextureInfo.getChild().dispose(),super.dispose()}getDoubleSided(){return this.X}setDoubleSided(e){return this.X=e,this}getAlpha(){return this.tt[3]}setAlpha(e){return this.tt[3]=e,this}getAlphaMode(){return this.Z}setAlphaMode(e){return this.Z=e,this}getAlphaCutoff(){return this.K}setAlphaCutoff(e){return this.K=e,this}getBaseColorFactor(){return this.tt}setBaseColorFactor(e){return this.tt=e,this}getBaseColorHex(){return b.factorToHex(this.tt)}setBaseColorHex(e){return b.hexToFactor(e,this.tt),this}getBaseColorTexture(){return this.baseColorTexture?this.baseColorTexture.getChild():null}getBaseColorTextureInfo(){return this.baseColorTexture?this.baseColorTextureInfo.getChild():null}setBaseColorTexture(e){return this.baseColorTexture=this.graph.linkTexture("baseColorTexture",Y|K|W|J,this,e),this}getEmissiveFactor(){return this.st}setEmissiveFactor(e){return this.st=e,this}getEmissiveHex(){return b.factorToHex(this.st)}setEmissiveHex(e){return b.hexToFactor(e,this.st),this}getEmissiveTexture(){return this.emissiveTexture?this.emissiveTexture.getChild():null}getEmissiveTextureInfo(){return this.emissiveTexture?this.emissiveTextureInfo.getChild():null}setEmissiveTexture(e){return this.emissiveTexture=this.graph.linkTexture("emissiveTexture",Y|K|W,this,e),this}getNormalScale(){return this.et}setNormalScale(e){return this.et=e,this}getNormalTexture(){return this.normalTexture?this.normalTexture.getChild():null}getNormalTextureInfo(){return this.normalTexture?this.normalTextureInfo.getChild():null}setNormalTexture(e){return this.normalTexture=this.graph.linkTexture("normalTexture",Y|K|W,this,e),this}getOcclusionStrength(){return this.it}setOcclusionStrength(e){return this.it=e,this}getOcclusionTexture(){return this.occlusionTexture?this.occlusionTexture.getChild():null}getOcclusionTextureInfo(){return this.occlusionTexture?this.occlusionTextureInfo.getChild():null}setOcclusionTexture(e){return this.occlusionTexture=this.graph.linkTexture("occlusionTexture",Y,this,e),this}getRoughnessFactor(){return this.rt}setRoughnessFactor(e){return this.rt=e,this}getMetallicFactor(){return this.nt}setMetallicFactor(e){return this.nt=e,this}getMetallicRoughnessTexture(){return this.metallicRoughnessTexture?this.metallicRoughnessTexture.getChild():null}getMetallicRoughnessTextureInfo(){return this.metallicRoughnessTexture?this.metallicRoughnessTextureInfo.getChild():null}setMetallicRoughnessTexture(e){return this.metallicRoughnessTexture=this.graph.linkTexture("metallicRoughnessTexture",K|W,this,e),this}}Z.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},p([d],Z.prototype,"baseColorTexture",void 0),p([d],Z.prototype,"baseColorTextureInfo",void 0),p([d],Z.prototype,"emissiveTexture",void 0),p([d],Z.prototype,"emissiveTextureInfo",void 0),p([d],Z.prototype,"normalTexture",void 0),p([d],Z.prototype,"normalTextureInfo",void 0),p([d],Z.prototype,"occlusionTexture",void 0),p([d],Z.prototype,"occlusionTextureInfo",void 0),p([d],Z.prototype,"metallicRoughnessTexture",void 0),p([d],Z.prototype,"metallicRoughnessTextureInfo",void 0);class Q extends P{constructor(...e){super(...e),this.propertyType=a.MESH,this.ht=[],this.primitives=[]}copy(e,t=O){return super.copy(e,t),this.ht=[...e.ht],this.clearGraphChildList(this.primitives),e.primitives.forEach((e=>this.addPrimitive(t(e.getChild())))),this}addPrimitive(e){return this.addGraphChild(this.primitives,this.graph.link("primitive",this,e))}removePrimitive(e){return this.removeGraphChild(this.primitives,e)}listPrimitives(){return this.primitives.map((e=>e.getChild()))}getWeights(){return this.ht}setWeights(e){return this.ht=e,this}}p([m],Q.prototype,"primitives",void 0);class ee extends P{constructor(...e){super(...e),this.propertyType=a.NODE,this.ot=[0,0,0],this.ut=[0,0,0,1],this.ct=[1,1,1],this.ht=[],this.i=null,this.camera=null,this.mesh=null,this.skin=null,this.children=[]}copy(e,t=O){return super.copy(e,t),this.ot=[...e.ot],this.ut=[...e.ut],this.ct=[...e.ct],this.ht=[...e.ht],this.setCamera(e.camera?t(e.camera.getChild()):null),this.setMesh(e.mesh?t(e.mesh.getChild()):null),this.setSkin(e.skin?t(e.skin.getChild()):null),t!==O&&(this.clearGraphChildList(this.children),e.children.forEach((e=>this.addChild(t(e.getChild()))))),this}getTranslation(){return this.ot}getRotation(){return this.ut}getScale(){return this.ct}setTranslation(e){return this.ot=e,this}setRotation(e){return this.ut=e,this}setScale(e){return this.ct=e,this}getMatrix(){return S.compose(this.ot,this.ut,this.ct,[])}setMatrix(e){return S.decompose(e,this.ot,this.ut,this.ct),this}getWorldTranslation(){const e=[0,0,0];return S.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return S.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return S.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let r=this;r instanceof ee;r=r.i)e.push(r);let t;const s=e.pop().getMatrix();for(;t=e.pop();)Object(n.c)(s,s,t.getMatrix());return s}addChild(e){e.i&&e.i.removeChild(e);const t=this.graph.link("child",this,e);return this.addGraphChild(this.children,t),e.i=this,t.onDispose((()=>e.i=null)),this}removeChild(e){return this.removeGraphChild(this.children,e)}listChildren(){return this.children.map((e=>e.getChild()))}getParent(){return this.i}getMesh(){return this.mesh?this.mesh.getChild():null}setMesh(e){return this.mesh=this.graph.link("mesh",this,e),this}getCamera(){return this.camera?this.camera.getChild():null}setCamera(e){return this.camera=this.graph.link("camera",this,e),this}getSkin(){return this.skin?this.skin.getChild():null}setSkin(e){return this.skin=this.graph.link("skin",this,e),this}getWeights(){return this.ht}setWeights(e){return this.ht=e,this}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}p([d],ee.prototype,"camera",void 0),p([d],ee.prototype,"mesh",void 0),p([d],ee.prototype,"skin",void 0),p([m],ee.prototype,"children",void 0);class te extends P{constructor(...e){super(...e),this.propertyType=a.PRIMITIVE,this.at=te.Mode.TRIANGLES,this.material=null,this.indices=null,this.attributes=[],this.targets=[]}copy(e,t=O){return super.copy(e,t),this.at=e.at,this.setIndices(e.indices?t(e.indices.getChild()):null),this.setMaterial(e.material?t(e.material.getChild()):null),this.clearGraphChildList(this.attributes),e.listSemantics().forEach((s=>{this.setAttribute(s,t(e.getAttribute(s)))})),this.clearGraphChildList(this.targets),e.targets.forEach((e=>this.addTarget(t(e.getChild())))),this}getIndices(){return this.indices?this.indices.getChild():null}setIndices(e){return this.indices=this.graph.linkIndex("index",this,e),this}getAttribute(e){const t=this.attributes.find((t=>t.semantic===e));return t?t.getChild():null}setAttribute(e,t){const s=this.getAttribute(e);if(s&&this.removeGraphChild(this.attributes,s),!t)return this;const r=this.graph.linkAttribute(e,this,t);return this.addGraphChild(this.attributes,r)}listAttributes(){return this.attributes.map((e=>e.getChild()))}listSemantics(){return this.attributes.map((e=>e.semantic))}getMaterial(){return this.material?this.material.getChild():null}setMaterial(e){return this.material=this.graph.link("material",this,e),this}getMode(){return this.at}setMode(e){return this.at=e,this}listTargets(){return this.targets.map((e=>e.getChild()))}addTarget(e){return this.addGraphChild(this.targets,this.graph.link("target",this,e)),this}removeTarget(e){return this.removeGraphChild(this.targets,e)}}te.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},p([d],te.prototype,"material",void 0),p([d],te.prototype,"indices",void 0),p([m],te.prototype,"attributes",void 0),p([m],te.prototype,"targets",void 0);class se extends U{constructor(...e){super(...e),this.propertyType=a.PRIMITIVE_TARGET,this.attributes=[]}copy(e,t=O){return super.copy(e,t),this.clearGraphChildList(this.attributes),e.listSemantics().forEach((s=>{this.setAttribute(s,t(e.getAttribute(s)))})),this}getAttribute(e){const t=this.attributes.find((t=>t.semantic===e));return t?t.getChild():null}setAttribute(e,t){const s=this.getAttribute(e);if(s&&this.removeGraphChild(this.attributes,s),!t)return this;const r=this.graph.linkAttribute(e.toLowerCase(),this,t);return r.semantic=e,this.addGraphChild(this.attributes,r)}listAttributes(){return this.attributes.map((e=>e.getChild()))}listSemantics(){return this.attributes.map((e=>e.semantic))}}p([m],se.prototype,"attributes",void 0);class re extends P{constructor(...e){super(...e),this.propertyType=a.SCENE,this.children=[]}copy(e,t=O){return super.copy(e,t),t!==O&&(this.clearGraphChildList(this.children),e.children.forEach((e=>this.addChild(t(e.getChild()))))),this}addChild(e){e.i&&e.i.removeChild(e);const t=this.graph.link("child",this,e);return this.addGraphChild(this.children,t),e.i=this,t.onDispose((()=>e.i=null)),this}removeChild(e){return this.removeGraphChild(this.children,e)}listChildren(){return this.children.map((e=>e.getChild()))}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}p([m],re.prototype,"children",void 0);class ne extends P{constructor(...e){super(...e),this.propertyType=a.SKIN,this.skeleton=null,this.inverseBindMatrices=null,this.joints=[]}copy(e,t=O){return super.copy(e,t),this.setSkeleton(e.skeleton?t(e.skeleton.getChild()):null),this.setInverseBindMatrices(e.inverseBindMatrices?t(e.inverseBindMatrices.getChild()):null),this.clearGraphChildList(this.joints),e.joints.forEach((e=>this.addJoint(t(e.getChild())))),this}getSkeleton(){return this.skeleton?this.skeleton.getChild():null}setSkeleton(e){return this.skeleton=this.graph.link("skeleton",this,e),this}getInverseBindMatrices(){return this.inverseBindMatrices?this.inverseBindMatrices.getChild():null}setInverseBindMatrices(e){return this.inverseBindMatrices=this.graph.link("inverseBindMatrices",this,e),this}addJoint(e){const t=this.graph.link("joint",this,e);return this.addGraphChild(this.joints,t)}removeJoint(e){return this.removeGraphChild(this.joints,e)}listJoints(){return this.joints.map((e=>e.getChild()))}}p([d],ne.prototype,"skeleton",void 0),p([d],ne.prototype,"inverseBindMatrices",void 0),p([m],ne.prototype,"joints",void 0);class ie extends P{constructor(...e){super(...e),this.propertyType=a.TEXTURE,this.lt=null,this.ft="",this.P=""}copy(e,t=O){return super.copy(e,t),this.ft=e.ft,this.P=e.P,e.lt&&(this.lt=e.lt.slice(0)),this}getMimeType(){return this.ft||I.extensionToMimeType(C.extension(this.P))}setMimeType(e){return this.ft=e,this}getURI(){return this.P}setURI(e){return this.P=e,this.ft=I.extensionToMimeType(C.extension(e)),this}getImage(){return this.lt}setImage(e){return this.lt=e,this}getSize(){return this.lt?I.getSize(this.lt,this.getMimeType()):null}}class oe extends U{constructor(e){super(e),this.propertyType=a.ROOT,this.dt={generator:"glTF-Transform v0.12.7",version:"2.0"},this.gt=new Set,this.defaultScene=null,this.accessors=[],this.animations=[],this.buffers=[],this.cameras=[],this.materials=[],this.meshes=[],this.nodes=[],this.scenes=[],this.skins=[],this.textures=[],e.on("clone",(e=>this.vt(e)))}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=O){if(super.copy(e,t),t===O)throw new Error("Root cannot be copied.");return Object.assign(this.dt,e.dt),e.accessors.forEach((e=>this.wt(t(e.getChild())))),e.animations.forEach((e=>this.Tt(t(e.getChild())))),e.buffers.forEach((e=>this.yt(t(e.getChild())))),e.cameras.forEach((e=>this.At(t(e.getChild())))),e.materials.forEach((e=>this.xt(t(e.getChild())))),e.meshes.forEach((e=>this.Et(t(e.getChild())))),e.nodes.forEach((e=>this.St(t(e.getChild())))),e.scenes.forEach((e=>this.Mt(t(e.getChild())))),e.skins.forEach((e=>this.bt(t(e.getChild())))),e.textures.forEach((e=>this.It(t(e.getChild())))),this.setDefaultScene(e.defaultScene?t(e.defaultScene.getChild()):null),this}vt(e){return e instanceof re?this.Mt(e):e instanceof ee?this.St(e):e instanceof B?this.At(e):e instanceof ne?this.bt(e):e instanceof Q?this.Et(e):e instanceof Z?this.xt(e):e instanceof ie?this.It(e):e instanceof j?this.Tt(e):e instanceof L?this.wt(e):e instanceof G&&this.yt(e),this}getAsset(){return this.dt}listExtensionsUsed(){return Array.from(this.gt)}listExtensionsRequired(){return this.listExtensionsUsed().filter((e=>e.isRequired()))}Rt(e){return this.gt.add(e),this}Nt(e){return this.gt.delete(e),this}Mt(e){return this.addGraphChild(this.scenes,this.graph.link("scene",this,e))}listScenes(){return this.scenes.map((e=>e.getChild()))}setDefaultScene(e){return this.defaultScene=this.graph.link("scene",this,e),this}getDefaultScene(){return this.defaultScene?this.defaultScene.getChild():null}St(e){return this.addGraphChild(this.nodes,this.graph.link("node",this,e))}listNodes(){return this.nodes.map((e=>e.getChild()))}At(e){return this.addGraphChild(this.cameras,this.graph.link("camera",this,e))}listCameras(){return this.cameras.map((e=>e.getChild()))}bt(e){return this.addGraphChild(this.skins,this.graph.link("skin",this,e))}listSkins(){return this.skins.map((e=>e.getChild()))}Et(e){return this.addGraphChild(this.meshes,this.graph.link("mesh",this,e))}listMeshes(){return this.meshes.map((e=>e.getChild()))}xt(e){return this.addGraphChild(this.materials,this.graph.link("material",this,e))}listMaterials(){return this.materials.map((e=>e.getChild()))}It(e){return this.addGraphChild(this.textures,this.graph.link("texture",this,e))}listTextures(){return this.textures.map((e=>e.getChild()))}Tt(e){return this.addGraphChild(this.animations,this.graph.link("animation",this,e))}listAnimations(){return this.animations.map((e=>e.getChild()))}wt(e){return this.addGraphChild(this.accessors,this.graph.link("accessor",this,e))}listAccessors(){return this.accessors.map((e=>e.getChild()))}yt(e){return this.addGraphChild(this.buffers,this.graph.link("buffer",this,e))}listBuffers(){return this.buffers.map((e=>e.getChild()))}}p([d],oe.prototype,"defaultScene",void 0),p([m],oe.prototype,"accessors",void 0),p([m],oe.prototype,"animations",void 0),p([m],oe.prototype,"buffers",void 0),p([m],oe.prototype,"cameras",void 0),p([m],oe.prototype,"materials",void 0),p([m],oe.prototype,"meshes",void 0),p([m],oe.prototype,"nodes",void 0),p([m],oe.prototype,"scenes",void 0),p([m],oe.prototype,"skins",void 0),p([m],oe.prototype,"textures",void 0);class ae{constructor(){this.Ct=new $,this._t=new oe(this.Ct),this.Lt=v.DEFAULT_INSTANCE}getRoot(){return this._t}getGraph(){return this.Ct}getLogger(){return this.Lt}setLogger(e){return this.Lt=e,this}clone(){return(new ae).merge(this).setLogger(this.Lt)}merge(e){const t={};for(const i of e.getRoot().listExtensionsUsed()){const e=this.createExtension(i.constructor);i.isRequired()&&e.setRequired(!0),t[e.extensionName]=e}const s=new Set,r=new Map;s.add(e._t),r.set(e._t,this._t);for(const i of e.Ct.getLinks())for(const e of[i.getParent(),i.getChild()]){if(s.has(e))continue;let n;if(e.propertyType===a.TEXTURE_INFO)n=e;else{const s=e.constructor;n=e instanceof V?new s(this.Ct,t[e.extensionName]):new s(this.Ct)}r.set(e,n),s.add(e)}const n=e=>{const t=r.get(e);if(!t)throw new Error("Could resolve property.");return t};for(const i of s){const e=r.get(i);if(!e)throw new Error("Could resolve property.");e.copy(i,n)}return this}async transform(...e){for(const t of e)await t(this);return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find((e=>e.extensionName===t))||new e(this)}createScene(e=""){const t=new re(this.Ct,e);return this._t.Mt(t),t}createNode(e=""){const t=new ee(this.Ct,e);return this._t.St(t),t}createCamera(e=""){const t=new B(this.Ct,e);return this._t.At(t),t}createSkin(e=""){const t=new ne(this.Ct,e);return this._t.bt(t),t}createMesh(e=""){const t=new Q(this.Ct,e);return this._t.Et(t),t}createPrimitive(){return new te(this.Ct)}createPrimitiveTarget(e=""){return new se(this.Ct,e)}createMaterial(e=""){const t=new Z(this.Ct,e);return this._t.xt(t),t}createTexture(e=""){const t=new ie(this.Ct,e);return this._t.It(t),t}createAnimation(e=""){const t=new j(this.Ct,e);return this._t.Tt(t),t}createAnimationChannel(e=""){return new k(this.Ct,e)}createAnimationSampler(e=""){return new D(this.Ct,e)}createAccessor(e="",t=null){t||(t=this.getRoot().listBuffers()[0]);const s=new L(this.Ct,e).setBuffer(t);return this._t.wt(s),s}createBuffer(e=""){const t=new G(this.Ct,e);return this._t.yt(t),t}}class ce{constructor(e){this.doc=void 0,this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.required=!1,this.properties=new Set,this.doc=e,e.getRoot().Rt(this)}dispose(){this.doc.getRoot().Nt(this);for(const e of this.properties)e.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}addExtensionProperty(e){return this.properties.add(e),this}removeExtensionProperty(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}function ue(){return(ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}ce.EXTENSION_NAME=void 0;class he{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),void 0!==t.texCoord&&e.setTexCoord(t.texCoord);const s=this.jsonDoc.json.textures[t.index];if(void 0===s.sampler)return;const r=this.jsonDoc.json.samplers[s.sampler];void 0!==r.magFilter&&e.setMagFilter(r.magFilter),void 0!==r.minFilter&&e.setMinFilter(r.minFilter),void 0!==r.wrapS&&e.setWrapS(r.wrapS),void 0!==r.wrapT&&e.setWrapT(r.wrapT)}}const le={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},pe={logger:v.DEFAULT_INSTANCE,extensions:[],dependencies:{}};class fe{static read(e,t=pe){const s=ue({},pe,t),{json:r}=e,n=new ae;this.validate(e,s);const i=new he(e),o=e.json.asset,c=n.getRoot().getAsset();o.copyright&&(c.copyright=o.copyright),o.extras&&(c.extras=o.extras),o.generator&&(c.generator=o.generator),o.minVersion&&(c.minVersion=o.minVersion);const u=r.extensionsUsed||[],h=r.extensionsRequired||[];for(const a of s.extensions)if(u.includes(a.EXTENSION_NAME)){const e=n.createExtension(a).setRequired(h.includes(a.EXTENSION_NAME));for(const t of e.readDependencies)e.install(t,s.dependencies[t])}const l=r.buffers||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(a.BUFFER))).forEach((e=>e.preread(i,a.BUFFER))),i.buffers=l.map((e=>{const t=n.createBuffer(e.name);return e.extras&&t.setExtras(e.extras),e.uri&&0!==e.uri.indexOf("__")&&t.setURI(e.uri),t})),i.bufferViewBuffers=(r.bufferViews||[]).map(((t,s)=>{if(!i.bufferViews[s]){const r=e.json.buffers[t.buffer],n=new Uint8Array(r.uri?e.resources[r.uri]:e.resources["@glb.bin"],t.byteOffset||0,t.byteLength);i.bufferViews[s]=n}return i.buffers[t.buffer]})),i.accessors=(r.accessors||[]).map((e=>{const t=n.createAccessor(e.name,i.bufferViewBuffers[e.bufferView]).setType(e.type);if(e.extras&&t.setExtras(e.extras),void 0!==e.normalized&&t.setNormalized(e.normalized),void 0===e.bufferView&&!e.sparse)return t;let s;return s=void 0!==e.sparse?function(e,t){const s=le[e.componentType],r=L.getElementSize(e.type);let n;n=void 0!==e.bufferView?ge(e,t):new s(e.count*r);const i=e.sparse,o=i.count,a=ue({},e,i.indices,{count:o,type:"SCALAR"}),c=ue({},e,i.values,{count:o}),u=ge(a,t),h=ge(c,t);for(let l=0;l<a.count;l++)for(let e=0;e<r;e++)n[u[l]*r+e]=h[l*r+e];return n}(e,i):ge(e,i),t.setArray(s),t}));const p=r.images||[],f=r.textures||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(a.TEXTURE))).forEach((e=>e.preread(i,a.TEXTURE))),i.textures=p.map((t=>{const s=n.createTexture(t.name);if(t.extras&&s.setExtras(t.extras),void 0!==t.bufferView){const n=r.bufferViews[t.bufferView],i=e.json.buffers[n.buffer],o=n.byteOffset||0,a=(i.uri?e.resources[i.uri]:e.resources["@glb.bin"]).slice(o,o+n.byteLength);s.setImage(a)}else void 0!==t.uri&&(s.setImage(e.resources[t.uri]),0!==t.uri.indexOf("__")&&s.setURI(t.uri));if(void 0!==t.mimeType)s.setMimeType(t.mimeType);else if(t.uri){const e=C.extension(t.uri);s.setMimeType(I.extensionToMimeType(e))}return s})),i.materials=(r.materials||[]).map((e=>{const t=n.createMaterial(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.alphaMode&&t.setAlphaMode(e.alphaMode),void 0!==e.alphaCutoff&&t.setAlphaCutoff(e.alphaCutoff),void 0!==e.doubleSided&&t.setDoubleSided(e.doubleSided);const s=e.pbrMetallicRoughness||{};if(void 0!==s.baseColorFactor&&t.setBaseColorFactor(s.baseColorFactor),void 0!==e.emissiveFactor&&t.setEmissiveFactor(e.emissiveFactor),void 0!==s.metallicFactor&&t.setMetallicFactor(s.metallicFactor),void 0!==s.roughnessFactor&&t.setRoughnessFactor(s.roughnessFactor),void 0!==s.baseColorTexture){const e=s.baseColorTexture;t.setBaseColorTexture(i.textures[f[e.index].source]),i.setTextureInfo(t.getBaseColorTextureInfo(),e)}if(void 0!==e.emissiveTexture){const s=e.emissiveTexture;t.setEmissiveTexture(i.textures[f[s.index].source]),i.setTextureInfo(t.getEmissiveTextureInfo(),s)}if(void 0!==e.normalTexture){const s=e.normalTexture;t.setNormalTexture(i.textures[f[s.index].source]),i.setTextureInfo(t.getNormalTextureInfo(),s),void 0!==e.normalTexture.scale&&t.setNormalScale(e.normalTexture.scale)}if(void 0!==e.occlusionTexture){const s=e.occlusionTexture;t.setOcclusionTexture(i.textures[f[s.index].source]),i.setTextureInfo(t.getOcclusionTextureInfo(),s),void 0!==e.occlusionTexture.strength&&t.setOcclusionStrength(e.occlusionTexture.strength)}if(void 0!==s.metallicRoughnessTexture){const e=s.metallicRoughnessTexture;t.setMetallicRoughnessTexture(i.textures[f[e.index].source]),i.setTextureInfo(t.getMetallicRoughnessTextureInfo(),e)}return t}));const g=r.meshes||[];n.getRoot().listExtensionsUsed().filter((e=>e.prereadTypes.includes(a.PRIMITIVE))).forEach((e=>e.preread(i,a.PRIMITIVE))),i.meshes=g.map((e=>{const t=n.createMesh(e.name);return e.extras&&t.setExtras(e.extras),void 0!==e.weights&&t.setWeights(e.weights),(e.primitives||[]).forEach((s=>{const r=n.createPrimitive();s.extras&&r.setExtras(s.extras),void 0!==s.material&&r.setMaterial(i.materials[s.material]),void 0!==s.mode&&r.setMode(s.mode);for(const[e,t]of Object.entries(s.attributes||{}))r.setAttribute(e,i.accessors[t]);void 0!==s.indices&&r.setIndices(i.accessors[s.indices]);const o=e.extras&&e.extras.targetNames||[];(s.targets||[]).forEach(((e,t)=>{const s=o[t]||t.toString(),a=n.createPrimitiveTarget(s);for(const[r,n]of Object.entries(e))a.setAttribute(r,i.accessors[n]);r.addTarget(a)})),t.addPrimitive(r)})),t})),i.cameras=(r.cameras||[]).map((e=>{const t=n.createCamera(e.name).setType(e.type);if(e.extras&&t.setExtras(e.extras),e.type===B.Type.PERSPECTIVE){const s=e.perspective;t.setYFov(s.yfov),t.setZNear(s.znear),void 0!==s.zfar&&t.setZFar(s.zfar),void 0!==s.aspectRatio&&t.setAspectRatio(s.aspectRatio)}else{const s=e.orthographic;t.setZNear(s.znear).setZFar(s.zfar).setXMag(s.xmag).setYMag(s.ymag)}return t}));const d=r.nodes||[];return i.nodes=d.map((e=>{const t=n.createNode(e.name);if(e.extras&&t.setExtras(e.extras),void 0!==e.translation&&t.setTranslation(e.translation),void 0!==e.rotation&&t.setRotation(e.rotation),void 0!==e.scale&&t.setScale(e.scale),void 0!==e.matrix){const s=[0,0,0],r=[0,0,0,1],n=[1,1,1];S.decompose(e.matrix,s,r,n),t.setTranslation(s),t.setRotation(r),t.setScale(n)}return void 0!==e.weights&&t.setWeights(e.weights),t})),i.skins=(r.skins||[]).map((e=>{const t=n.createSkin(e.name);e.extras&&t.setExtras(e.extras),void 0!==e.inverseBindMatrices&&t.setInverseBindMatrices(i.accessors[e.inverseBindMatrices]),void 0!==e.skeleton&&t.setSkeleton(i.nodes[e.skeleton]);for(const s of e.joints)t.addJoint(i.nodes[s]);return t})),d.map(((e,t)=>{const s=i.nodes[t];(e.children||[]).forEach((e=>s.addChild(i.nodes[e]))),void 0!==e.mesh&&s.setMesh(i.meshes[e.mesh]),void 0!==e.camera&&s.setCamera(i.cameras[e.camera]),void 0!==e.skin&&s.setSkin(i.skins[e.skin])})),i.animations=(r.animations||[]).map((e=>{const t=n.createAnimation(e.name);e.extras&&t.setExtras(e.extras);const s=(e.samplers||[]).map((e=>{const s=n.createAnimationSampler().setInput(i.accessors[e.input]).setOutput(i.accessors[e.output]).setInterpolation(e.interpolation||D.Interpolation.LINEAR);return e.extras&&s.setExtras(e.extras),t.addSampler(s),s}));return(e.channels||[]).forEach((e=>{const r=n.createAnimationChannel().setSampler(s[e.sampler]).setTargetNode(i.nodes[e.target.node]).setTargetPath(e.target.path);e.extras&&r.setExtras(e.extras),t.addChannel(r)})),t})),i.scenes=(r.scenes||[]).map((e=>{const t=n.createScene(e.name);return e.extras&&t.setExtras(e.extras),(e.nodes||[]).map((e=>i.nodes[e])).forEach((e=>t.addChild(e))),t})),void 0!==r.scene&&n.getRoot().setDefaultScene(i.scenes[r.scene]),n.getRoot().listExtensionsUsed().forEach((e=>e.read(i))),n}static validate(e,t){const s=e.json;if("2.0"!==s.asset.version)throw new Error(`Unsupported glTF version, "${s.asset.version}".`);if(s.extensionsRequired)for(const r of s.extensionsRequired)if(!t.extensions.find((e=>e.EXTENSION_NAME===r)))throw new Error(`Missing required extension, "${r}".`);if(s.extensionsUsed)for(const r of s.extensionsUsed)t.extensions.find((e=>e.EXTENSION_NAME===r))||t.logger.warn(`Missing optional extension, "${r}".`)}}function ge(e,t){const s=t.bufferViews[e.bufferView],r=t.jsonDoc.json.bufferViews[e.bufferView],n=le[e.componentType],i=L.getElementSize(e.type),o=n.BYTES_PER_ELEMENT;if(void 0!==r.byteStride&&r.byteStride!==i*o)return function(e,t){const s=t.bufferViews[e.bufferView],r=t.jsonDoc.json.bufferViews[e.bufferView],n=le[e.componentType],i=L.getElementSize(e.type),o=n.BYTES_PER_ELEMENT,a=e.byteOffset||0,c=new n(e.count*i),u=new DataView(s.buffer,s.byteOffset,s.byteLength),h=r.byteStride;for(let l=0;l<e.count;l++)for(let t=0;t<i;t++){const s=a+l*h+t*o;let r;switch(e.componentType){case L.ComponentType.FLOAT:r=u.getFloat32(s,!0);break;case L.ComponentType.UNSIGNED_INT:r=u.getUint32(s,!0);break;case L.ComponentType.UNSIGNED_SHORT:r=u.getUint16(s,!0);break;case L.ComponentType.UNSIGNED_BYTE:r=u.getUint8(s);break;case L.ComponentType.SHORT:r=u.getInt16(s,!0);break;case L.ComponentType.BYTE:r=u.getInt8(s);break;default:throw new Error(`Unexpected componentType "${e.componentType}".`)}c[l*i+t]=r}return c}(e,t);const a=s.byteOffset+(e.byteOffset||0);return new n(s.buffer.slice(a,a+e.count*i*o))}class de{constructor(e,t,s){this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.Ot=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.jsonDoc=t,this.options=s;const r=e.getRoot(),n=r.listBuffers().length,i=r.listTextures().length;this.bufferURIGenerator=new me(n>1,s.basename),this.imageURIGenerator=new me(i>1,s.basename),this.logger=e.getLogger()}createTextureInfoDef(e,t){const s={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},r=JSON.stringify(s);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const n={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},i=JSON.stringify(n);this.textureDefIndexMap.has(i)||(this.textureDefIndexMap.set(i,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(n));const o={index:this.textureDefIndexMap.get(i)};return 0!==t.getTexCoord()&&(o.texCoord=t.getTexCoord()),this.textureInfoDefMap.set(t,o),o}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),e.getMax(t.max=[]),e.getMin(t.min=[]),t.normalized=e.getNormalized(),t}createImageData(e,t,s){if(this.options.format===h.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const r=I.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,r),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){return this.Ot.get(e)||null}setAccessorUsage(e,t){const s=this.Ot.get(e);if(s&&s!==t)throw new Error(`Accessor with usage "${s}" cannot be reused as "${t}".`);return this.Ot.set(e,t),this}listAccessorsByUsage(){const e={};for(const[t,s]of Array.from(this.Ot.entries()))e[s]=e[s]||[],e[s].push(t);return e}}class me{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=t}createURI(e,t){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${t}`:`${this.basename}.${t}`}}class xe{static write(e,t){const s=e.getRoot(),r={asset:ue({},s.getAsset(),{generator:"glTF-Transform v0.12.7"})},n={json:r,resources:{}},i=new de(e,n,t),o=t.logger||v.DEFAULT_INSTANCE;for(const a of e.getRoot().listExtensionsUsed())for(const e of a.writeDependencies)a.install(e,t.dependencies[e]);function u(e,t,s,n){const o=[];let a=0;for(const u of e){const e=i.createAccessorDef(u);e.bufferView=r.bufferViews.length;const t=E.pad(u.getArray().buffer);e.byteOffset=a,a+=t.byteLength,o.push(t),i.accessorIndexMap.set(u,r.accessors.length),r.accessors.push(e)}const c={buffer:t,byteOffset:s,byteLength:E.concat(o).byteLength};return n&&(c.target=n),r.bufferViews.push(c),{buffers:o,byteLength:a}}function l(e,t,s){const n=e[0].getCount();let o=0;for(const h of e){const e=i.createAccessorDef(h);e.bufferView=r.bufferViews.length,e.byteOffset=o;const t=h.getElementSize(),s=h.getComponentSize();o+=E.padNumber(t*s),i.accessorIndexMap.set(h,r.accessors.length),r.accessors.push(e)}const a=n*o,c=new ArrayBuffer(a),u=new DataView(c);for(let r=0;r<n;r++){let t=0;for(const s of e){const e=s.getElementSize(),n=s.getComponentSize(),i=s.getComponentType(),a=s.getArray();for(let s=0;s<e;s++){const c=r*o+t+s*n,h=a[r*e+s];switch(i){case L.ComponentType.FLOAT:u.setFloat32(c,h,!0);break;case L.ComponentType.BYTE:u.setInt8(c,h);break;case L.ComponentType.SHORT:u.setInt16(c,h,!0);break;case L.ComponentType.UNSIGNED_BYTE:u.setUint8(c,h);break;case L.ComponentType.UNSIGNED_SHORT:u.setUint16(c,h,!0);break;case L.ComponentType.UNSIGNED_INT:u.setUint32(c,h,!0);break;default:throw new Error("Unexpected component type: "+i)}}t+=E.padNumber(e*n)}}return r.bufferViews.push({buffer:t,byteOffset:s,byteLength:a,byteStride:o,target:34962}),{byteLength:a,buffers:[c]}}const p=new Map;for(const a of e.getGraph().getLinks()){if(a.getParent()===s)continue;const e=a.getChild();if(e instanceof L){const t=p.get(e)||[];t.push(a),p.set(e,t)}}r.accessors=[],r.bufferViews=[],r.samplers=[],r.textures=[],r.images=s.listTextures().map(((e,t)=>{const s=i.createPropertyDef(e);e.getMimeType()&&(s.mimeType=e.getMimeType());const r=e.getImage();return r&&i.createImageData(s,r,e),i.imageIndexMap.set(e,t),s})),e.getRoot().listExtensionsUsed().filter((e=>e.prewriteTypes.includes(a.ACCESSOR))).forEach((e=>e.prewrite(i,a.ACCESSOR))),r.buffers=[],s.listBuffers().forEach((e=>{const s=i.createPropertyDef(e),o=i.accessorUsageGroupedByParent,a=new Map,f=e.listParents().filter((e=>e instanceof L)),g=new Set(f);for(const t of f){if(i.accessorIndexMap.has(t))continue;const e=p.get(t)||[];for(const r of e){if(i.getAccessorUsage(t))break;r instanceof z?i.setAccessorUsage(t,"ARRAY_BUFFER"):r instanceof q?i.setAccessorUsage(t,"ELEMENT_ARRAY_BUFFER"):"inverseBindMatrices"===r.getName()&&i.setAccessorUsage(t,"INVERSE_BIND_MATRICES")}i.getAccessorUsage(t)||i.setAccessorUsage(t,"OTHER");const s=i.getAccessorUsage(t);if(s&&o.has(s)){const s=e[0].getParent(),r=a.get(s)||new Set;r.add(t),a.set(s,r)}}const d=[],m=r.buffers.length;let x=0;const T=i.listAccessorsByUsage();for(const r in T)if(o.has(r))for(const e of Array.from(a.values())){const s=Array.from(e).filter((e=>g.has(e))).filter((e=>i.getAccessorUsage(e)===r));if(s.length)if("ARRAY_BUFFER"!==r||t.vertexLayout===c.INTERLEAVED){const e="ARRAY_BUFFER"===r?l(s,m,x):u(s,m,x);x+=e.byteLength,d.push(...e.buffers)}else for(const e of s){const t=l([e],m,x);x+=t.byteLength,d.push(...t.buffers)}}else{const e=T[r].filter((e=>g.has(e)));if(!e.length)continue;const t=u(e,m,x,"ELEMENT_ARRAY_BUFFER"===r?34963:void 0);x+=t.byteLength,d.push(...t.buffers)}if(i.imageBufferViews.length)for(let t=0;t<i.imageBufferViews.length;t++)if(r.bufferViews[r.images[t].bufferView].byteOffset=x,x+=i.imageBufferViews[t].byteLength,d.push(i.imageBufferViews[t]),x%4){const e=4-x%4;x+=e,d.push(new ArrayBuffer(e))}if(i.otherBufferViews.has(e))for(const t of i.otherBufferViews.get(e))r.bufferViews.push({buffer:m,byteOffset:x,byteLength:t.byteLength}),i.otherBufferViewsIndexMap.set(t,r.bufferViews.length-1),x+=t.byteLength,d.push(t);if(!x)return void i.logger.warn(`@gltf-transform/core: Skipping empty buffer, "${e.getName()}".`);let y;t.format===h.GLB?y="@glb.bin":(y=i.bufferURIGenerator.createURI(e,"bin"),s.uri=y),s.byteLength=x,n.resources[y]=E.concat(d),r.buffers.push(s)})),s.listAccessors().find((e=>!e.getBuffer()))&&o.warn("Skipped writing one or more Accessors: no Buffer assigned."),r.materials=s.listMaterials().map(((e,t)=>{const s=i.createPropertyDef(e);if(e.getAlphaMode()!==Z.AlphaMode.OPAQUE&&(s.alphaMode=e.getAlphaMode()),e.getAlphaMode()===Z.AlphaMode.MASK&&(s.alphaCutoff=e.getAlphaCutoff()),e.getDoubleSided()&&(s.doubleSided=!0),s.pbrMetallicRoughness={},S.eq(e.getBaseColorFactor(),[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=e.getBaseColorFactor()),S.eq(e.getEmissiveFactor(),[0,0,0])||(s.emissiveFactor=e.getEmissiveFactor()),1!==e.getRoughnessFactor()&&(s.pbrMetallicRoughness.roughnessFactor=e.getRoughnessFactor()),1!==e.getMetallicFactor()&&(s.pbrMetallicRoughness.metallicFactor=e.getMetallicFactor()),e.getBaseColorTexture()){const t=e.getBaseColorTexture(),r=e.getBaseColorTextureInfo();s.pbrMetallicRoughness.baseColorTexture=i.createTextureInfoDef(t,r)}if(e.getEmissiveTexture()){const t=e.getEmissiveTexture(),r=e.getEmissiveTextureInfo();s.emissiveTexture=i.createTextureInfoDef(t,r)}if(e.getNormalTexture()){const t=e.getNormalTexture(),r=e.getNormalTextureInfo(),n=i.createTextureInfoDef(t,r);1!==e.getNormalScale()&&(n.scale=e.getNormalScale()),s.normalTexture=n}if(e.getOcclusionTexture()){const t=e.getOcclusionTexture(),r=e.getOcclusionTextureInfo(),n=i.createTextureInfoDef(t,r);1!==e.getOcclusionStrength()&&(n.strength=e.getOcclusionStrength()),s.occlusionTexture=n}if(e.getMetallicRoughnessTexture()){const t=e.getMetallicRoughnessTexture(),r=e.getMetallicRoughnessTextureInfo();s.pbrMetallicRoughness.metallicRoughnessTexture=i.createTextureInfoDef(t,r)}return i.materialIndexMap.set(e,t),s})),r.meshes=s.listMeshes().map(((e,t)=>{const s=i.createPropertyDef(e);let r=null;return s.primitives=e.listPrimitives().map((e=>{const t={attributes:{}};t.mode=e.getMode();const s=e.getMaterial();s&&(t.material=i.materialIndexMap.get(s)),Object.keys(e.getExtras()).length&&(t.extras=e.getExtras());const n=e.getIndices();n&&(t.indices=i.accessorIndexMap.get(n));for(const r of e.listSemantics())t.attributes[r]=i.accessorIndexMap.get(e.getAttribute(r));for(const r of e.listTargets()){const e={};for(const t of r.listSemantics())e[t]=i.accessorIndexMap.get(r.getAttribute(t));t.targets=t.targets||[],t.targets.push(e)}return e.listTargets().length&&!r&&(r=e.listTargets().map((e=>e.getName()))),t})),e.getWeights().length&&(s.weights=e.getWeights()),r&&(s.extras=s.extras||{},s.extras.targetNames=r),i.meshIndexMap.set(e,t),s})),r.cameras=s.listCameras().map(((e,t)=>{const s=i.createPropertyDef(e);if(s.type=e.getType(),s.type===B.Type.PERSPECTIVE){s.perspective={znear:e.getZNear(),zfar:e.getZFar(),yfov:e.getYFov()};const t=e.getAspectRatio();null!==t&&(s.perspective.aspectRatio=t)}else s.orthographic={znear:e.getZNear(),zfar:e.getZFar(),xmag:e.getXMag(),ymag:e.getYMag()};return i.cameraIndexMap.set(e,t),s})),r.nodes=s.listNodes().map(((e,t)=>{const s=i.createPropertyDef(e);return S.eq(e.getTranslation(),[0,0,0])||(s.translation=e.getTranslation()),S.eq(e.getRotation(),[0,0,0,1])||(s.rotation=e.getRotation()),S.eq(e.getScale(),[1,1,1])||(s.scale=e.getScale()),e.getWeights().length&&(s.weights=e.getWeights()),i.nodeIndexMap.set(e,t),s})),r.skins=s.listSkins().map(((e,t)=>{const s=i.createPropertyDef(e),r=e.getInverseBindMatrices();r&&(s.inverseBindMatrices=i.accessorIndexMap.get(r));const n=e.getSkeleton();return n&&(s.skeleton=i.nodeIndexMap.get(n)),s.joints=e.listJoints().map((e=>i.nodeIndexMap.get(e))),i.skinIndexMap.set(e,t),s})),s.listNodes().forEach(((e,t)=>{const s=r.nodes[t],n=e.getMesh();n&&(s.mesh=i.meshIndexMap.get(n));const o=e.getCamera();o&&(s.camera=i.cameraIndexMap.get(o));const a=e.getSkin();a&&(s.skin=i.skinIndexMap.get(a)),e.listChildren().length>0&&(s.children=e.listChildren().map((e=>i.nodeIndexMap.get(e))))})),r.animations=s.listAnimations().map((e=>{const t=i.createPropertyDef(e),s=new Map;return t.samplers=e.listSamplers().map(((e,t)=>{const r=i.createPropertyDef(e);return r.input=i.accessorIndexMap.get(e.getInput()),r.output=i.accessorIndexMap.get(e.getOutput()),r.interpolation=e.getInterpolation(),s.set(e,t),r})),t.channels=e.listChannels().map((e=>{const t=i.createPropertyDef(e);return t.sampler=s.get(e.getSampler()),t.target={node:i.nodeIndexMap.get(e.getTargetNode()),path:e.getTargetPath()},t})),t})),r.scenes=s.listScenes().map((e=>{const t=i.createPropertyDef(e);return t.nodes=e.listChildren().map((e=>i.nodeIndexMap.get(e))),t}));const f=s.getDefaultScene();return f&&(r.scene=s.listScenes().indexOf(f)),r.extensionsUsed=s.listExtensionsUsed().map((e=>e.extensionName)),r.extensionsRequired=s.listExtensionsRequired().map((e=>e.extensionName)),s.listExtensionsUsed().forEach((e=>e.write(i))),function(e){const t=[];for(const s in e){const r=e[s];Array.isArray(r)&&0===r.length?t.push(s):null!==r&&""!==r||t.push(s)}for(const s of t)delete e[s]}(r),n}}var Te;!function(e){e[e.JSON=1313821514]="JSON",e[e.BIN=5130562]="BIN"}(Te||(Te={}));class ye{constructor(){this.Lt=v.DEFAULT_INSTANCE,this.gt=[],this.Bt={},this.Pt=c.INTERLEAVED}setLogger(e){return this.Lt=e,this}registerExtensions(e){for(const t of e)this.gt.push(t),t.register();return this}registerDependencies(e){return Object.assign(this.Bt,e),this}setVertexLayout(e){return this.Pt=e,this}Ut(e){function t(t){if(t.uri&&!(t.uri in e.resources)&&t.uri.match(/data:/)){const s=`__${M()}.${C.extension(t.uri)}`;e.resources[s]=E.createBufferFromDataURI(t.uri),t.uri=s}}(e.json.images||[]).forEach((e=>{if(void 0===e.bufferView&&void 0===e.uri)throw new Error("Missing resource URI or buffer view.");t(e)})),(e.json.buffers||[]).forEach(t)}readJSON(e){return this.Ut(e),fe.read(e,{extensions:this.gt,dependencies:this.Bt,logger:this.Lt})}writeJSON(e,t={}){if(t.format===h.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0\u20131 buffers.");return xe.write(e,{format:t.format||h.GLTF,logger:t.logger||this.Lt,vertexLayout:t.vertexLayout||this.Pt,dependencies:ue({},this.Bt,t.dependencies),basename:t.basename||""})}binaryToJSON(e){const t=this.kt(e),s=t.json;if(s.buffers&&s.buffers.find((e=>void 0!==e.uri)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.find((e=>void 0===e.bufferView)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}kt(e){const t=new Uint32Array(e,0,3);if(1179937895!==t[0])throw new Error("Invalid glTF asset.");if(2!==t[1])throw new Error(`Unsupported glTF binary version, "${t[1]}".`);const s=new Uint32Array(e,12,2);if(s[1]!==Te.JSON)throw new Error("Missing required GLB JSON chunk.");const r=s[0],n=E.decodeText(e.slice(20,20+r)),i=JSON.parse(n),o=20+r;if(e.byteLength<=o)return{json:i,resources:{}};const a=new Uint32Array(e,o,2);if(a[1]!==Te.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:i,resources:{"@glb.bin":e.slice(o+8,o+8+a[0])}}}readBinary(e){return this.readJSON(this.binaryToJSON(e))}writeBinary(e){const{json:t,resources:s}=this.writeJSON(e,{format:h.GLB,basename:"",logger:this.Lt,dependencies:this.Bt,vertexLayout:this.Pt}),r=new Uint32Array([1179937895,2,12]),n=JSON.stringify(t),i=E.pad(E.encodeText(n),32),o=new Uint32Array([i.byteLength,1313821514]).buffer,a=E.concat([o,i]);r[r.length-1]+=a.byteLength;const c=Object.values(s)[0];if(!c||!c.byteLength)return E.concat([r.buffer,a]);const u=E.pad(c,0),l=new Uint32Array([u.byteLength,5130562]).buffer,p=E.concat([l,u]);return r[r.length-1]+=p.byteLength,E.concat([r.buffer,a,p])}}class Ee extends ye{constructor(){super(),this.Ft=void 0,this.Gt=void 0,this.lastReadBytes=0,this.lastWriteBytes=0,this.Ft=s(1),this.Gt=s(2)}read(e){const t=this.readAsJSON(e);return fe.read(t,{extensions:this.gt,dependencies:this.Bt,logger:this.Lt})}readAsJSON(e){return e.match(/\.glb$/)||e.match(/^data:application\/octet-stream;/)?this.jt(e):this.Dt(e)}write(e,t){e.match(/\.glb$/)?this.Jt(e,t):this.zt(e,t)}$t(e,t){[...e.json.images||[],...e.json.buffers||[]].forEach((s=>{if(s.uri&&!s.uri.match(/data:/)){const r=this.Gt.resolve(t,s.uri);e.resources[s.uri]=E.trim(this.Ft.readFileSync(r)),this.lastReadBytes+=e.resources[s.uri].byteLength}}))}jt(e){const t=this.Ft.readFileSync(e),s=E.trim(t);this.lastReadBytes=s.byteLength;const r=this.kt(s);return this.$t(r,this.Gt.dirname(e)),this.Ut(r),r}Dt(e){this.lastReadBytes=0;const t=this.Ft.readFileSync(e,"utf8");this.lastReadBytes+=t.length;const s={json:JSON.parse(t),resources:{}};return this.$t(s,this.Gt.dirname(e)),this.Ut(s),s}zt(t,s){this.lastWriteBytes=0;const{json:r,resources:n}=xe.write(s,{format:h.GLTF,logger:this.Lt,dependencies:this.Bt,vertexLayout:this.Pt,basename:C.basename(t)}),{Ft:i,Gt:o}=this,a=o.dirname(t),c=JSON.stringify(r,null,2);this.lastWriteBytes+=c.length,i.writeFileSync(t,c),Object.keys(n).forEach((t=>{const s=e.from(n[t]);i.writeFileSync(o.join(a,t),s),this.lastWriteBytes+=s.byteLength}))}Jt(t,s){const r=e.from(this.writeBinary(s));this.Ft.writeFileSync(t,r),this.lastWriteBytes=r.byteLength}}const be={};class Ce extends ye{constructor(e=be){super(),this.Vt=void 0,this.Vt=e}read(e){return this.readAsJSON(e).then((e=>this.readJSON(e)))}readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||new URL(e,window.location.href).pathname.match(/\.glb$/)?this.jt(e):this.Dt(e)}$t(e,t){const s=[...e.json.images||[],...e.json.buffers||[]].map((s=>{const r=s.uri;return r?fetch(function(e,t){if(!function(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}(t))return t;const s=e.split("/"),r=t.split("/");s.pop();for(let n=0;n<r.length;n++)"."!==r[n]&&(".."===r[n]?s.pop():s.push(r[n]));return s.join("/")}(t,r),this.Vt).then((e=>e.arrayBuffer())).then((t=>{e.resources[r]=t})):Promise.resolve()}));return Promise.all(s).then((()=>{}))}Dt(e){var t=this;const s={json:{},resources:{}};return fetch(e,this.Vt).then((e=>e.json())).then((async function(r){return s.json=r,t.Ut(s),await t.$t(s,_e(e)),s}))}jt(e){var t=this;return fetch(e,this.Vt).then((e=>e.arrayBuffer())).then((async function(s){const r=t.kt(s);return t.Ut(r),await t.$t(r,_e(e)),r}))}}function _e(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}.call(this,s("HDXh").Buffer)},Pbiu:function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return l})),s.d(t,"b",(function(){return p}));var r=s("tbvF"),n=s.n(r),i=s("Ytbt"),o=s.n(i);function a(e,t,s={}){const r=document.createElement("canvas");r.width=e.shape[0],r.height=e.shape[1];const n=r.getContext("2d"),i=n.getImageData(0,0,r.width,r.height);try{u(e,i.data)}catch(e){return h.from(Promise.reject(e))}n.putImageData(i,0,0);const o=s.quality?s.quality/100:void 0;switch(t){case"canvas":return r;case"jpg":case"jpeg":return c(r,"image/jpeg",o);case"png":return c(r,"image/png");default:throw new Error("[ndarray-pixels] Unsupported file type: "+t)}}function c(e,t,s){const r=new Promise(((r,n)=>{e.toBlob((async e=>{e?r(new Uint8Array(await e.arrayBuffer())):n(new Error("[ndarray-pixels] Failed to canvas.toBlob()."))}),t,s)}));return h.from(r)}function u(e,t,s=-1){if(4===e.shape.length)return u(e.pick(s),t,0);if(3===e.shape.length)if(3===e.shape[2])o.a.assign(n()(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),e),o.a.assigns(n()(t,[e.shape[0]*e.shape[1]],[4],3),255);else if(4===e.shape[2])o.a.assign(n()(t,[e.shape[0],e.shape[1],4],[4,4*e.shape[0],1]),e);else{if(1!==e.shape[2])throw new Error("[ndarray-pixels] Incompatible array shape.");o.a.assign(n()(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),n()(e.data,[e.shape[0],e.shape[1],3],[e.stride[0],e.stride[1],0],e.offset)),o.a.assigns(n()(t,[e.shape[0]*e.shape[1]],[4],3),255)}else{if(2!==e.shape.length)throw new Error("[ndarray-pixels] Incompatible array shape.");o.a.assign(n()(t,[e.shape[0],e.shape[1],3],[4,4*e.shape[0],1]),n()(e.data,[e.shape[0],e.shape[1],3],[e.stride[0],e.stride[1],0],e.offset)),o.a.assigns(n()(t,[e.shape[0]*e.shape[1]],[4],3),255)}return t}class h{constructor(e){this._promise=e}on(e,t){return"data"===e?this._promise.then(t):"error"===e?this._promise.catch(t):"end"===e&&this._promise.finally(t),this}static from(e){return new h(e)}}async function l(t,s){return t instanceof Uint8Array&&"undefined"!=typeof e&&(t=e.from(t)),new Promise(((e,r)=>{!function(e,t,s){if(s=s||t,e instanceof Uint8Array){if("string"!=typeof t)throw new Error("[ndarray-pixels] Type must be given for Uint8Array image data");const s=new Blob([e],{type:t});e=URL.createObjectURL(s)}const r=new Image;r.crossOrigin="anonymous",r.onload=function(){URL.revokeObjectURL(e);const t=document.createElement("canvas");t.width=r.width,t.height=r.height;const i=t.getContext("2d");i.drawImage(r,0,0);const o=i.getImageData(0,0,r.width,r.height);s(null,n()(new Uint8Array(o.data),[r.width,r.height,4],[4,4*r.width,1],0))},r.onerror=t=>{URL.revokeObjectURL(e),s(t)},r.src=e}(t,s,((t,s)=>{s&&!t?e(s):r(t)}))}))}async function p(e,t){return new Promise(((s,r)=>{const n=[],i=t.replace("image/","");a(e,i).on("data",(e=>n.push(e))).on("end",(()=>s(function(e){let t=0;for(const n of e)t+=n.byteLength;const s=new Uint8Array(t);let r=0;for(const n of e)s.set(n,r),r+=n.byteLength;return s}(n)))).on("error",(e=>r(e)))}))}}).call(this,s("HDXh").Buffer)},QM7d:function(e,t,s){"use strict";var r=s("033R");function n(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}e.exports=function(e){var t=new n;t.pre=e.pre,t.body=e.body,t.post=e.post;var s=e.args.slice(0);t.argTypes=s;for(var i=0;i<s.length;++i){var o=s[i];if("array"===o||"object"===typeof o&&o.blockIndices){if(t.argTypes[i]="array",t.arrayArgs.push(i),t.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),t.shimArgs.push("array"+i),i<t.pre.args.length&&t.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array args");if(i<t.post.args.length&&t.post.args[i].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===o)t.scalarArgs.push(i),t.shimArgs.push("scalar"+i);else if("index"===o){if(t.indexArgs.push(i),i<t.pre.args.length&&t.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array index");if(i<t.body.args.length&&t.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array index");if(i<t.post.args.length&&t.post.args[i].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===o){if(t.shapeArgs.push(i),i<t.pre.args.length&&t.pre.args[i].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(i<t.body.args.length&&t.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array shape");if(i<t.post.args.length&&t.post.args[i].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!==typeof o||!o.offset)throw new Error("cwise: Unknown argument type "+s[i]);t.argTypes[i]="offset",t.offsetArgs.push({array:o.array,offset:o.offset}),t.offsetArgIndex.push(i)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>s.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>s.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>s.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,r(t)}},TBio:function(e,t,s){"use strict";var r=s("F16p");function n(e,t,s){var r,n,i=e.length,o=t.arrayArgs.length,a=t.indexArgs.length>0,c=[],u=[],h=0,l=0;for(r=0;r<i;++r)u.push(["i",r,"=0"].join(""));for(n=0;n<o;++n)for(r=0;r<i;++r)l=h,h=e[r],0===r?u.push(["d",n,"s",r,"=t",n,"p",h].join("")):u.push(["d",n,"s",r,"=(t",n,"p",h,"-s",l,"*t",n,"p",l,")"].join(""));for(u.length>0&&c.push("var "+u.join(",")),r=i-1;r>=0;--r)h=e[r],c.push(["for(i",r,"=0;i",r,"<s",h,";++i",r,"){"].join(""));for(c.push(s),r=0;r<i;++r){for(l=h,h=e[r],n=0;n<o;++n)c.push(["p",n,"+=d",n,"s",r].join(""));a&&(r>0&&c.push(["index[",l,"]-=s",l].join("")),c.push(["++index[",h,"]"].join(""))),c.push("}")}return c.join("\n")}function i(e,t,s){for(var r=e.body,n=[],i=[],o=0;o<e.args.length;++o){var a=e.args[o];if(!(a.count<=0)){var c=new RegExp(a.name,"g"),u="",h=t.arrayArgs.indexOf(o);switch(t.argTypes[o]){case"offset":var l=t.offsetArgIndex.indexOf(o);h=t.offsetArgs[l].array,u="+q"+l;case"array":u="p"+h+u;var p="l"+o,f="a"+h;if(0===t.arrayBlockIndices[h])1===a.count?"generic"===s[h]?a.lvalue?(n.push(["var ",p,"=",f,".get(",u,")"].join("")),r=r.replace(c,p),i.push([f,".set(",u,",",p,")"].join(""))):r=r.replace(c,[f,".get(",u,")"].join("")):r=r.replace(c,[f,"[",u,"]"].join("")):"generic"===s[h]?(n.push(["var ",p,"=",f,".get(",u,")"].join("")),r=r.replace(c,p),a.lvalue&&i.push([f,".set(",u,",",p,")"].join(""))):(n.push(["var ",p,"=",f,"[",u,"]"].join("")),r=r.replace(c,p),a.lvalue&&i.push([f,"[",u,"]=",p].join("")));else{for(var g=[a.name],d=[u],m=0;m<Math.abs(t.arrayBlockIndices[h]);m++)g.push("\\s*\\[([^\\]]+)\\]"),d.push("$"+(m+1)+"*t"+h+"b"+m);if(c=new RegExp(g.join(""),"g"),u=d.join("+"),"generic"===s[h])throw new Error("cwise: Generic arrays not supported in combination with blocks!");r=r.replace(c,[f,"[",u,"]"].join(""))}break;case"scalar":r=r.replace(c,"Y"+t.scalarArgs.indexOf(o));break;case"index":r=r.replace(c,"index");break;case"shape":r=r.replace(c,"shape")}}}return[n.join("\n"),r,i.join("\n")].join("\n").trim()}function o(e){for(var t=new Array(e.length),s=!0,r=0;r<e.length;++r){var n=e[r],i=n.match(/\d+/);i=i?i[0]:"",0===n.charAt(0)?t[r]="u"+n.charAt(1)+i:t[r]=n.charAt(0)+i,r>0&&(s=s&&t[r]===t[r-1])}return s?t[0]:t.join("")}e.exports=function(e,t){for(var s=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,a=new Array(e.arrayArgs.length),c=new Array(e.arrayArgs.length),u=0;u<e.arrayArgs.length;++u)c[u]=t[2*u],a[u]=t[2*u+1];var h=[],l=[],p=[],f=[],g=[];for(u=0;u<e.arrayArgs.length;++u){e.arrayBlockIndices[u]<0?(p.push(0),f.push(s),h.push(s),l.push(s+e.arrayBlockIndices[u])):(p.push(e.arrayBlockIndices[u]),f.push(e.arrayBlockIndices[u]+s),h.push(0),l.push(e.arrayBlockIndices[u]));for(var d=[],m=0;m<a[u].length;m++)p[u]<=a[u][m]&&a[u][m]<f[u]&&d.push(a[u][m]-p[u]);g.push(d)}var x=["SS"],T=["'use strict'"],y=[];for(m=0;m<s;++m)y.push(["s",m,"=SS[",m,"]"].join(""));for(u=0;u<e.arrayArgs.length;++u){x.push("a"+u),x.push("t"+u),x.push("p"+u);for(m=0;m<s;++m)y.push(["t",u,"p",m,"=t",u,"[",p[u]+m,"]"].join(""));for(m=0;m<Math.abs(e.arrayBlockIndices[u]);++m)y.push(["t",u,"b",m,"=t",u,"[",h[u]+m,"]"].join(""))}for(u=0;u<e.scalarArgs.length;++u)x.push("Y"+u);if(e.shapeArgs.length>0&&y.push("shape=SS.slice(0)"),e.indexArgs.length>0){var E=new Array(s);for(u=0;u<s;++u)E[u]="0";y.push(["index=[",E.join(","),"]"].join(""))}for(u=0;u<e.offsetArgs.length;++u){var b=e.offsetArgs[u],C=[];for(m=0;m<b.offset.length;++m)0!==b.offset[m]&&(1===b.offset[m]?C.push(["t",b.array,"p",m].join("")):C.push([b.offset[m],"*t",b.array,"p",m].join("")));0===C.length?y.push("q"+u+"=0"):y.push(["q",u,"=",C.join("+")].join(""))}var _=r([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((y=y.concat(_)).length>0&&T.push("var "+y.join(",")),u=0;u<e.arrayArgs.length;++u)T.push("p"+u+"|=0");e.pre.body.length>3&&T.push(i(e.pre,e,c));var I=i(e.body,e,c),A=function(e){for(var t=0,s=e[0].length;t<s;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}(g);A<s?T.push(function(e,t,s,r){for(var i=t.length,o=s.arrayArgs.length,a=s.blockSize,c=s.indexArgs.length>0,u=[],h=0;h<o;++h)u.push(["var offset",h,"=p",h].join(""));for(h=e;h<i;++h)u.push(["for(var j"+h+"=SS[",t[h],"]|0;j",h,">0;){"].join("")),u.push(["if(j",h,"<",a,"){"].join("")),u.push(["s",t[h],"=j",h].join("")),u.push(["j",h,"=0"].join("")),u.push(["}else{s",t[h],"=",a].join("")),u.push(["j",h,"-=",a,"}"].join("")),c&&u.push(["index[",t[h],"]=j",h].join(""));for(h=0;h<o;++h){for(var l=["offset"+h],p=e;p<i;++p)l.push(["j",p,"*t",h,"p",t[p]].join(""));u.push(["p",h,"=(",l.join("+"),")"].join(""))}for(u.push(n(t,s,r)),h=e;h<i;++h)u.push("}");return u.join("\n")}(A,g[0],e,I)):T.push(n(g[0],e,I)),e.post.body.length>3&&T.push(i(e.post,e,c)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+T.join("\n")+"\n----------");var S=[e.funcName||"unnamed","_cwise_loop_",a[0].join("s"),"m",A,o(c)].join("");return new Function(["function ",S,"(",x.join(","),"){",T.join("\n"),"} return ",S].join(""))()}},Ylik:function(e,t,s){"use strict";s.r(t),s.d(t,"bounds",(function(){return r.bounds})),s.d(t,"QUANTIZE_DEFAULTS",(function(){return X})),s.d(t,"TEXTURE_RESIZE_DEFAULTS",(function(){return le})),s.d(t,"TextureResizeFilter",(function(){return ue})),s.d(t,"center",(function(){return E})),s.d(t,"colorspace",(function(){return b})),s.d(t,"dedup",(function(){return _})),s.d(t,"inspect",(function(){return S})),s.d(t,"instance",(function(){return L})),s.d(t,"metalRough",(function(){return G})),s.d(t,"partition",(function(){return V})),s.d(t,"prune",(function(){return H})),s.d(t,"quantize",(function(){return Y})),s.d(t,"resample",(function(){return te})),s.d(t,"sequence",(function(){return ne})),s.d(t,"tangents",(function(){return oe})),s.d(t,"textureResize",(function(){return pe})),s.d(t,"unweld",(function(){return ge})),s.d(t,"weld",(function(){return xe}));var r=s("Nt23"),n=s("Pbiu"),i=s("ZUXO"),o=s("tbvF"),a=s.n(o);const c=(e,t)=>{if(e<=-t||e>=t)return 0;const s=e*Math.PI;return Math.sin(s)/s*Math.sin(s/t)/(s/t)},u=e=>Math.round(16383*e),h=(e,t,s,r,n)=>{const i=n?2:3,o=1/s,a=Math.min(1,s),h=i/a,l=Math.floor(2*(h+1)),p=new Int16Array((l+2)*t);let f=0;for(let g=0;g<t;g++){const s=(g+.5)*o+r,n=Math.max(0,Math.floor(s-h)),l=Math.min(e-1,Math.ceil(s+h)),d=l-n+1,m=new Float32Array(d),x=new Int16Array(d);let T=0,y=0;for(let e=n;e<=l;e++){const t=c((e+.5-s)*a,i);T+=t,m[y]=t,y++}let E=0;for(let e=0;e<m.length;e++){const t=m[e]/T;E+=t,x[e]=u(t)}x[t>>1]+=u(1-E);let b=0;for(;b<x.length&&0===x[b];)b++;let C=x.length-1;for(;C>0&&0===x[C];)C--;const _=C-b+1;p[f++]=n+b,p[f++]=_,p.set(x.subarray(b,C+1),f),f+=_}return p},l=e=>e<0?0:e>255?255:e,p=(e,t,s)=>{const[r,n]=e.shape,[i]=t.shape;for(let o=0;o<n;o++){const r=o;let n=0;for(let a=0;a<i;a++){let i=s[n++],c=0,u=0,h=0,p=0;for(let t=s[n++];t>0;t--){const t=s[n++];c+=t*e.get(i,o,0),u+=t*e.get(i,o,1),h+=t*e.get(i,o,2),p+=t*e.get(i,o,3),i++}t.set(a,r,0,l(c+8192>>14)),t.set(a,r,1,l(u+8192>>14)),t.set(a,r,2,l(h+8192>>14)),t.set(a,r,3,l(p+8192>>14))}}};var f,g;function d(e,t,s){const[r,n]=e.shape,[i,o]=t.shape,c=o/n,u=h(r,i,i/r,0,s===f.LANCZOS_2),l=h(n,o,c,0,s===f.LANCZOS_2),g=a()(new Uint8Array(i*n*4),[n,i,4]),d=g.transpose(1,0),m=t.transpose(1,0);p(e,d,u),p(g,m,l)}function m(e,t){d(e,t,f.LANCZOS_3)}function x(e,t){d(e,t,f.LANCZOS_2)}function T(){return(T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}(g=f||(f={}))[g.LANCZOS_3=3]="LANCZOS_3",g[g.LANCZOS_2=2]="LANCZOS_2";const y={pivot:"center"};function E(e=y){const t=T({},y,e);return e=>{const s=e.getLogger(),n=e.getRoot(),i=n.listAnimations().length>0||n.listSkins().length>0;e.getRoot().listScenes().forEach(((o,a)=>{let c;if(s.debug(`center: Scene ${a+1} / ${n.listScenes().length}.`),"string"==typeof t.pivot){const e=Object(r.bounds)(o);c=[(e.max[0]-e.min[0])/2+e.min[0],(e.max[1]-e.min[1])/2+e.min[1],(e.max[2]-e.min[2])/2+e.min[2]],"above"===t.pivot&&(c[1]=e.max[1]),"below"===t.pivot&&(c[1]=e.min[1])}else c=t.pivot;s.debug(`center: Pivot "${c.join(", ")}".`);const u=[-1*c[0],-1*c[1],-1*c[2]];if(i){s.debug("center: Model contains animation or skin. Adding a wrapper node.");const t=e.createNode("Pivot").setTranslation(u);o.listChildren().forEach((e=>t.addChild(e))),o.addChild(t)}else s.debug("center: Skipping wrapper, offsetting all root nodes."),o.listChildren().forEach((e=>{const t=e.getTranslation();e.setTranslation([t[0]+u[0],t[1]+u[1],t[2]+u[2]])}))})),s.debug("center: Complete.")}}function b(e){return t=>{const s=t.getLogger();if("linear"===e.inputEncoding)return void s.info("colorspace: Vertex colors already linear. Skipping conversion.");if("sRGB"!==e.inputEncoding)return void s.error(`colorspace: Unknown input encoding "${e.inputEncoding}" \u2013 should be "sRGB" or "linear". Skipping conversion.`);const r=new Set;function n(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function i(e){const t=[0,0,0];let s;for(let i=0;s=e.getAttribute(`COLOR_${i}`);i++)if(!r.has(s)){for(let e=0;e<s.getCount();e++)s.getElement(e,t),t[0]=n(t[0]),t[1]=n(t[1]),t[2]=n(t[2]),s.setElement(e,t);r.add(s)}}t.getRoot().listMeshes().forEach((e=>e.listPrimitives().forEach(i))),s.debug("colorspace: Complete.")}}const C={propertyTypes:[r.PropertyType.ACCESSOR,r.PropertyType.MESH,r.PropertyType.TEXTURE]},_=function(e=C){const t=T({},C,e),s=new Set(t.propertyTypes);for(const r of t.propertyTypes)if(!C.propertyTypes.includes(r))throw new Error(`dedup: Unsupported deduplication on type "${r}".`);return e=>{const t=e.getLogger();s.has(r.PropertyType.ACCESSOR)&&function(e,t){const s=new Set,n=new Set,i=t.getRoot().listMeshes();function o(e){const t=new Map;for(let s=0;s<e.length;s++){const n=e[s],i=n.getArray().slice().buffer;if(!t.has(n))for(let s=0;s<e.length;s++){const o=e[s];n!==o&&(t.has(o)||n.getType()===o.getType()&&n.getComponentType()===o.getComponentType()&&n.getCount()===o.getCount()&&n.getNormalized()===o.getNormalized()&&r.BufferUtils.equals(i,o.getArray().slice().buffer)&&t.set(o,n))}}return t}i.forEach((e=>{e.listPrimitives().forEach((e=>{e.listAttributes().forEach((e=>n.add(e)));const t=e.getIndices();t&&s.add(t)}))}));const a=o(Array.from(s));e.debug(`dedup: Found ${a.size} duplicates among ${s.size} indices.`);const c=o(Array.from(n));e.debug(`dedup: Found ${c.size} duplicates among ${n.size} attributes.`),i.forEach((e=>{e.listPrimitives().forEach((e=>{e.listAttributes().forEach((t=>{c.has(t)&&e.swap(t,c.get(t))}));const t=e.getIndices();t&&a.has(t)&&e.swap(t,a.get(t))}))})),Array.from(a.keys()).forEach((e=>e.dispose())),Array.from(c.keys()).forEach((e=>e.dispose()))}(t,e),s.has(r.PropertyType.MESH)&&function(e,t){const s=t.getRoot(),n=new Map;s.listAccessors().forEach(((e,t)=>{n.set(e,t)}));const i=s.listMeshes().length,o=new Map;for(const a of s.listMeshes()){const e=[];for(const s of a.listPrimitives()){const t=[];for(const e of s.listSemantics()){const r=s.getAttribute(e);t.push(e+":"+n.get(r))}const r=s.getIndices();r&&t.push("indices:"+n.get(r)),e.push(t.join(","))}const t=e.join(";");if(o.has(t)){const e=o.get(t);a.listParents().forEach((t=>{t.propertyType!==r.PropertyType.ROOT&&t.swap(a,e)})),a.dispose()}else o.set(t,a)}e.debug(`dedup: Found ${i-o.size} duplicates among ${i} meshes.`)}(t,e),s.has(r.PropertyType.TEXTURE)&&function(e,t){const s=t.getRoot(),n=s.listTextures(),i=new Map;for(let o=0;o<n.length;o++){const e=n[o],t=e.getImage();if(!i.has(e))for(let s=0;s<n.length;s++){const o=n[s],a=o.getImage();if(e===o)continue;if(i.has(o))continue;if(e.getMimeType()!==o.getMimeType())continue;const c=e.getSize(),u=o.getSize();c&&u&&c[0]===u[0]&&c[1]===u[1]&&t&&a&&r.BufferUtils.equals(t,a)&&i.set(o,e)}}e.debug(`dedup: Found ${i.size} duplicates among ${s.listTextures().length} textures.`),Array.from(i.entries()).forEach((([e,t])=>{e.listParents().forEach((s=>{s instanceof r.Root||s.swap(e,t)})),e.dispose()}))}(t,e),t.debug("dedup: Complete.")}};async function I(e,t,s){if(!e)return null;const r=e.getImage();if(!r)return null;const i=await Object(n.a)(new Uint8Array(r),e.getMimeType());for(let n=0;n<i.shape[0];++n)for(let e=0;e<i.shape[1];++e)s(i,n,e);const o=(await Object(n.b)(i,"image/png")).buffer;return t.setImage(o).setMimeType("image/png")}function A(e){const t=e.getIndices(),s=e.getAttribute("POSITION");switch(e.getMode()){case r.Primitive.Mode.POINTS:return s.getCount();case r.Primitive.Mode.LINES:return t?t.getCount()/2:s.getCount()/2;case r.Primitive.Mode.LINE_LOOP:return s.getCount();case r.Primitive.Mode.LINE_STRIP:return s.getCount()-1;case r.Primitive.Mode.TRIANGLES:return t?t.getCount()/3:s.getCount()/3;case r.Primitive.Mode.TRIANGLE_STRIP:case r.Primitive.Mode.TRIANGLE_FAN:return s.getCount()-2;default:throw new Error("Unexpected mode: "+e.getMode())}}function S(e){return{scenes:v(e),meshes:N(e),materials:w(e),textures:R(e),animations:M(e)}}function v(e){return{properties:e.getRoot().listScenes().map((e=>{const t=e.listChildren()[0],s=Object(r.bounds)(e);return{name:e.getName(),rootName:t?t.getName():"",bboxMin:U(s.min),bboxMax:U(s.max)}}))}}function N(e){return{properties:e.getRoot().listMeshes().map((e=>{const t=e.listParents().filter((e=>"Root"!==e.propertyType)).length;let s=0,r=0;const n=new Set,i=new Set,o=new Set;e.listPrimitives().forEach((e=>{for(const s of e.listSemantics()){const t=e.getAttribute(s);n.add(s+":"+F(t.getArray())),o.add(t)}for(const s of e.listTargets())s.listAttributes().forEach((e=>o.add(e)));const t=e.getIndices();t&&(i.add(F(t.getArray())),o.add(t)),r+=e.listAttributes()[0].getCount(),s+=A(e)}));let a=0;Array.from(o).forEach((e=>a+=e.getArray().byteLength));const c=e.listPrimitives().map((e=>O[e.getMode()]));return{name:e.getName(),mode:Array.from(new Set(c)),primitives:e.listPrimitives().length,glPrimitives:s,vertices:r,indices:Array.from(i).sort(),attributes:Array.from(n).sort(),instances:t,size:a}}))}}function w(e){return{properties:e.getRoot().listMaterials().map((t=>{const s=t.listParents().filter((e=>"Root"!==e.propertyType)).length,n=new Set(t.listExtensions()),i=e.getGraph().getLinks().filter((e=>{const s=e.getChild(),i=e.getParent();return s instanceof r.Texture&&i===t||!!(s instanceof r.Texture&&i instanceof r.ExtensionProperty&&n.has(i))})).map((e=>e.getName()));return{name:t.getName(),instances:s,textures:i,alphaMode:t.getAlphaMode(),doubleSided:t.getDoubleSided()}}))}}function R(e){return{properties:e.getRoot().listTextures().map((t=>{const s=t.listParents().filter((e=>"Root"!==e.propertyType)).length,n=e.getGraph().listParentLinks(t).map((e=>e.getName())).filter((e=>"texture"!==e)),i=r.ImageUtils.getSize(t.getImage(),t.getMimeType());return{name:t.getName(),uri:t.getURI(),slots:Array.from(new Set(n)),instances:s,mimeType:t.getMimeType(),resolution:i?i.join("x"):"",size:t.getImage().byteLength,gpuSize:r.ImageUtils.getMemSize(t.getImage(),t.getMimeType())}}))}}function M(e){return{properties:e.getRoot().listAnimations().map((e=>{let t=1/0,s=-1/0;e.listSamplers().forEach((e=>{const r=e.getInput();r&&(t=Math.min(t,r.getMin([])[0]),s=Math.max(s,r.getMax([])[0]))}));let r=0,n=0;const i=new Set;return e.listSamplers().forEach((e=>{const t=e.getInput(),s=e.getOutput();t&&(n+=t.getCount(),i.add(t),s&&i.add(s))})),Array.from(i).forEach((e=>{r+=e.getArray().byteLength})),{name:e.getName(),channels:e.listChannels().length,samplers:e.listSamplers().length,duration:Math.round(1e3*(s-t))/1e3,keyframes:n,size:r}}))}}const O=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function U(e){for(let t=0;t<e.length;t++)e[t].toFixed&&(e[t]=Number(e[t].toFixed(5)));return e}function F(e){return e.constructor.name.replace("Array","").toLowerCase()}const P={};function L(e=P){return T({},P,e),e=>{const t=e.getLogger(),s=e.getRoot(),n=e.createExtension(i.MeshGPUInstancing);if(s.listAnimations().length)throw new Error("instance: Instancing is not currently supported for animated models.");let o=0,a=0;for(const i of s.listScenes()){const s=new Map;i.traverse((e=>{const t=e.getMesh();t&&s.set(t,(s.get(t)||new Set).add(e))}));const c=[];for(const u of Array.from(s.keys())){const h=Array.from(s.get(u));if(h.length<2)continue;if(h.some((e=>e.getSkin())))continue;const l=k(e,n,u,h.length),p=l.getAttribute("TRANSLATION"),f=l.getAttribute("ROTATION"),g=l.getAttribute("SCALE"),d=e.createNode().setMesh(u).setExtension("EXT_mesh_gpu_instancing",l);i.addChild(d);let m=!1,x=!1,T=!1;for(let e=0;e<h.length;e++){let t,s,n;const i=h[e];p.setElement(e,t=i.getWorldTranslation()),f.setElement(e,s=i.getWorldRotation()),g.setElement(e,n=i.getWorldScale()),r.MathUtils.eq(t,[0,0,0])||(m=!0),r.MathUtils.eq(s,[0,0,0,1])||(x=!0),r.MathUtils.eq(n,[1,1,1])||(T=!0),i.setMesh(null),c.push(i)}m||p.dispose(),x||f.dispose(),T||g.dispose(),j(c,t),o++,a+=h.length}}o>0?t.info(`instance: Created ${o} batches, with ${a} total instances.`):(t.info("instance: No meshes with multiple parent nodes were found."),n.dispose()),t.debug("instance: Complete.")}}function j(e,t){let s,n=0;for(;s=e.pop();){if(s.listChildren().length||s.getCamera()||s.getMesh()||s.getSkin()||s.listExtensions().length)continue;const t=s.getParent();t instanceof r.Node&&e.push(t),s.dispose(),n++}t.debug(`instance: Removed ${n} unused nodes.`)}function k(e,t,s,r){const n=s.listPrimitives()[0].getAttribute("POSITION").getBuffer(),i=e.createAccessor().setType("VEC3").setArray(new Float32Array(3*r)).setBuffer(n),o=e.createAccessor().setType("VEC4").setArray(new Float32Array(4*r)).setBuffer(n),a=e.createAccessor().setType("VEC3").setArray(new Float32Array(3*r)).setBuffer(n);return t.createInstancedMesh().setAttribute("TRANSLATION",i).setAttribute("ROTATION",o).setAttribute("SCALE",a)}const D={};function G(e=D){return T({},D,e),async e=>{const t=e.getLogger(),s=i.MaterialsPBRSpecularGlossiness.EXTENSION_NAME;if(!e.getRoot().listExtensionsUsed().map((e=>e.extensionName)).includes(s))return void t.warn(`metalRough: Extension ${s} not found on given document.`);const r=e.createExtension(i.MaterialsIOR),n=e.createExtension(i.MaterialsSpecular),o=e.createExtension(i.MaterialsPBRSpecularGlossiness),a=new Set;for(const i of e.getRoot().listMaterials()){const t=i.getExtension("KHR_materials_pbrSpecularGlossiness");if(!t)continue;const s=n.createSpecular().setSpecularFactor(1).setSpecularColorFactor(t.getSpecularFactor());a.add(t.getSpecularGlossinessTexture()),a.add(i.getBaseColorTexture()),a.add(i.getMetallicRoughnessTexture()),i.setBaseColorFactor(t.getDiffuseFactor()).setMetallicFactor(0).setRoughnessFactor(1).setExtension("KHR_materials_ior",r.createIOR().setIOR(1e3)).setExtension("KHR_materials_specular",s);const o=t.getDiffuseTexture();o&&(i.setBaseColorTexture(o),i.getBaseColorTextureInfo().copy(t.getDiffuseTextureInfo()));const c=t.getSpecularGlossinessTexture();if(c){const r=t.getSpecularGlossinessTextureInfo(),n=e.createTexture();await I(c,n,((e,t,s)=>{e.set(t,s,3,255)})),s.setSpecularTexture(n),s.setSpecularColorTexture(n),s.getSpecularTextureInfo().copy(r),s.getSpecularColorTextureInfo().copy(r);const o=t.getGlossinessFactor(),a=e.createTexture();await I(c,a,((e,t,s)=>{const r=255-Math.round(e.get(t,s,3)*o);e.set(t,s,0,0),e.set(t,s,1,r),e.set(t,s,2,0),e.set(t,s,3,255)})),i.setMetallicRoughnessTexture(a),i.getMetallicRoughnessTextureInfo().copy(r)}else s.setSpecularColorFactor(t.getSpecularFactor()),i.setRoughnessFactor(1-t.getGlossinessFactor());i.setExtension("KHR_materials_pbrSpecularGlossiness",null)}o.dispose();for(const i of a)i&&1===i.listParents().length&&i.dispose();t.debug("metalRough: Complete.")}}const B={animations:!0,meshes:!0},V=(e=B)=>{const t=T({},B,e);return e=>{const s=e.getLogger();!1!==t.meshes&&function(e,t,s){const r=new Set(e.getRoot().listBuffers().map((e=>e.getURI())));e.getRoot().listMeshes().forEach(((n,i)=>{if(Array.isArray(s.meshes)&&!s.meshes.includes(n.getName()))return void t.debug(`partition: Skipping mesh #${i} with name "${n.getName()}".`);t.debug(`partition: Creating buffer for mesh "${n.getName()}".`);const o=e.createBuffer(n.getName()).setURI(z(n.getName()||"mesh",r));n.listPrimitives().forEach((e=>{const t=e.getIndices();t&&t.setBuffer(o),e.listAttributes().forEach((e=>e.setBuffer(o))),e.listTargets().forEach((e=>{e.listAttributes().forEach((e=>e.setBuffer(o)))}))}))}))}(e,s,t),!1!==t.animations&&function(e,t,s){const r=new Set(e.getRoot().listBuffers().map((e=>e.getURI())));e.getRoot().listAnimations().forEach(((n,i)=>{if(Array.isArray(s.animations)&&!s.animations.includes(n.getName()))return void t.debug(`partition: Skipping animation #${i} with name "${n.getName()}".`);t.debug(`partition: Creating buffer for animation "${n.getName()}".`);const o=e.createBuffer(n.getName()).setURI(z(n.getName()||"animation",r));n.listSamplers().forEach((e=>{const t=e.getInput(),s=e.getOutput();t&&t.setBuffer(o),s&&s.setBuffer(o)}))}))}(e,s,t),t.meshes||t.animations||s.warn("partition: Select animations or meshes to create a partition."),s.debug("partition: Complete.")}};function z(e,t){let s=`${e}.bin`,r=1;for(;t.has(s);)s=`${e}_${r++}.bin`;return s}const q={},H=function(e=q){return T({},q,e),e=>{const t=e.getLogger(),s=e.getRoot(),n=e.getGraph(),i={};s.listNodes().forEach(o),s.listSkins().forEach(o),s.listMeshes().forEach(o),s.listCameras().forEach(o),a(n,r.PropertyType.PRIMITIVE),a(n,r.PropertyType.PRIMITIVE_TARGET);for(const r of s.listAnimations()){for(const e of r.listChannels())e.getTargetNode()||(e.dispose(),c(e));if(r.listChannels().length)r.listSamplers().forEach(o);else{const e=r.listSamplers();o(r),e.forEach(o)}}if(s.listMaterials().forEach(o),s.listTextures().forEach(o),s.listAccessors().forEach(o),s.listBuffers().forEach(o),Object.keys(i).length){const e=Object.keys(i).map((e=>`${e} (${i[e]})`)).join(", ");t.info(`prune: Removed types... ${e}`)}else t.info("prune: No unused properties found.");function o(e){e.listParents().filter((e=>!(e instanceof r.Root||e instanceof r.AnimationChannel))).length||(e.dispose(),c(e))}function a(e,t){e.getLinks().map((e=>e.getParent())).filter((e=>e.propertyType===t)).forEach(o)}function c(e){i[e.propertyType]=i[e.propertyType]||0,i[e.propertyType]++}t.debug("prune: Complete.")}},$=[Int8Array,Int16Array,Int32Array],X={excludeAttributes:[],quantizationVolume:"mesh",quantizePosition:14,quantizeNormal:10,quantizeTexcoord:12,quantizeColor:8,quantizeWeight:8,quantizeGeneric:12},Y=(e=X)=>{const t=T({},X,e);return e=>{const s=e.getLogger(),n=e.getRoot();let o;e.createExtension(i.MeshQuantization).setRequired(!0),"scene"===t.quantizationVolume&&(1!==n.listScenes().length?s.warn("[quantize]: quantizationVolume=scene requires exactly 1 scene."):o=Object(r.bounds)(n.listScenes().pop()));for(const r of e.getRoot().listMeshes()){if(r.listPrimitives().some((e=>e.getAttribute("JOINTS_0")))){s.warn("quantize: Quantization for skinned mesh not yet implemented.");continue}const n=W(r,o);n&&J(e,r,n);for(const s of r.listPrimitives()){K(e,s,n,t);for(const r of s.listTargets())K(e,r,n,t)}}s.debug("quantize: Complete.")}};function K(e,t,s,n){const i=e.getRoot(),o=e.getLogger(),a=s?s.nodeRemap:null;for(const r of t.listSemantics()){if(n.excludeAttributes.includes(r))continue;const s=t.getAttribute(r),{bits:c,ctor:u}=Q(r,s,o,n);if(!u)continue;if(c<8||c>16)throw new Error("quantize: Requires bits = 8\u201316.");if(s.getComponentSize()<=c/8)continue;const h=e.getGraph().listParentLinks(s).filter((e=>e.getParent()!==i)).map((e=>e.getName()));if(new Set(h).size>1)o.warn(`quantize: Skipping ${r}; attribute usage conflict.`);else{if("POSITION"===r){if(!a)throw new Error("quantize: Failed precondition; missing node transform.");for(let e=0,t=[0,0,0],r=s.getCount();e<r;e++)s.setElement(e,a(s.getElement(e,t)))}Z(s,u,c),s.setNormalized(!0)}}if(t instanceof r.Primitive&&t.getIndices()&&t.listAttributes().length&&t.listAttributes()[0].getCount()<65535){const e=t.getIndices();e.setArray(new Uint16Array(e.getArray()))}}function W(e,t){const s=e.listPrimitives().map((e=>e.getAttribute("POSITION")));if(!s.some((e=>!!e)))return null;let r=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];return t?(r=[...t.min],n=[...t.max]):function(e,t,s){const r=s[0].getElementSize();for(let o=0;o<r;o++)e[o]=1/0;for(let o=0;o<r;o++)t[o]=-1/0;const n=[],i=[];for(const o of s){o.getMinNormalized(n),o.getMaxNormalized(i);for(let s=0;s<r;s++)e[s]=Math.min(e[s],n[s]),t[s]=Math.max(t[s],i[s])}}(r,n,s),{nodeRemap:e=>[2*(e[0]-r[0])/(n[0]-r[0])-1,2*(e[1]-r[1])/(n[1]-r[1])-1,2*(e[2]-r[2])/(n[2]-r[2])-1],nodeOffset:[r[0]+(n[0]-r[0])/2,r[1]+(n[1]-r[1])/2,r[2]+(n[2]-r[2])/2],nodeScale:[(n[0]-r[0])/2,(n[1]-r[1])/2,(n[2]-r[2])/2]}}function J(e,t,s){const n=s.nodeOffset||[0,0,0],i=s.nodeScale||[1,1,1];for(const o of t.listParents())if(o instanceof r.Node){const s=o.listChildren().length>0,a=!!o.listParents().find((e=>e instanceof r.Animation));let c;s||a?(c=e.createNode("").setMesh(t),o.addChild(c).setMesh(null)):c=o;const u=c.getTranslation(),h=c.getScale();c.setTranslation([u[0]+n[0],u[1]+n[1],u[2]+n[2]]).setScale([h[0]*i[0],h[1]*i[1],h[2]*i[2]])}}function Z(e,t,s){const r=new t(e.getArray().length),n=$.includes(t)?1:0,i=s-n,o=8*t.BYTES_PER_ELEMENT-n,a=Math.pow(2,i)-1,c=o-i,u=2*i-o;for(let h=0,l=0,p=[];h<e.getCount();h++){e.getElement(h,p);for(let e=0;e<p.length;e++){let t=Math.round(Math.abs(p[e])*a);t=t<<c|t>>u,r[l++]=t*Math.sign(p[e])}}e.setArray(r)}function Q(e,t,s,r){const n=t.getMinNormalized([]),i=t.getMinNormalized([]);let o,a;if("POSITION"===e)o=r.quantizePosition,a=o<=8?Int8Array:Int16Array;else if("NORMAL"===e||"TANGENT"===e)o=r.quantizeNormal,a=o<=8?Int8Array:Int16Array;else if(e.startsWith("COLOR_"))o=r.quantizeColor,a=o<=8?Uint8Array:Uint16Array;else if(e.startsWith("TEXCOORD_")){if(n.some((e=>e<0))||i.some((e=>e>1)))return s.warn(`quantize: Skipping ${e}; out of supported range.`),{bits:-1};o=r.quantizeTexcoord,a=o<=8?Uint8Array:Uint16Array}else{if(e.startsWith("JOINTS_"))return o=Math.max(...t.getMax([]))<=255?8:16,a=o<=8?Uint8Array:Uint16Array,t.getComponentSize()>o/8&&t.setArray(new a(t.getArray())),{bits:-1};if(e.startsWith("WEIGHTS_")){if(n.some((e=>e<0))||i.some((e=>e>1)))return s.warn(`quantize: Skipping ${e}; out of supported range.`),{bits:-1};o=r.quantizeWeight,a=o<=8?Uint8Array:Uint16Array}else{if(!e.startsWith("_"))throw new Error(`quantize: Unexpected semantic, "${e}".`);if(n.some((e=>e<-1))||i.some((e=>e>1)))return s.warn(`quantize: Skipping ${e}; out of supported range.`),{bits:-1};o=r.quantizeGeneric,a=a=n.some((e=>e<0))?o<=8?Int8Array:Int16Array:o<=8?Uint8Array:Uint16Array}}return{bits:o,ctor:a}}const ee={tolerance:1e-4},te=(e=ee)=>{const t=T({},ee,e);return e=>{const s=new Set,n=e.getRoot().listAccessors().length,i=e.getLogger();let o=!1;for(const r of e.getRoot().listAnimations()){const e=new Set;for(const t of r.listChannels())t.getSampler()&&"weights"===t.getTargetPath()&&e.add(t.getSampler());for(const n of r.listSamplers())e.has(n)?o=!0:"STEP"!==n.getInterpolation()&&"LINEAR"!==n.getInterpolation()||(s.add(n.getInput()),s.add(n.getOutput()),se(n,t))}for(const t of Array.from(s.values()))t.listParents().some((e=>!(e instanceof r.Root)))||t.dispose();e.getRoot().listAccessors().length>n&&i.warn('resample: Resampling required copying accessors, some of which may be duplicates. Consider using "dedup" to consolidate any duplicates.'),o&&i.warn("resample: Skipped optimizing morph target keyframes, not yet supported."),i.debug("resample: Complete.")}};function se(e,t){const s=e.getInput().clone(),r=e.getOutput().clone(),n=t.tolerance,i=s.getCount()-1,o=[];let a=1;for(let u=1;u<i;++u){const t=s.getScalar(u),i=s.getScalar(u-1),h=s.getScalar(u+1),l=(t-i)/(h-i);let p=!1;if(t!==h&&(1!==u||t!==s.getScalar(0)))for(let s=0;s<r.getElementSize();s++){const t=r.getElement(u,o)[s],i=r.getElement(u-1,o)[s],a=r.getElement(u+1,o)[s];if("LINEAR"===e.getInterpolation()){if(Math.abs(t-(i*(1-(c=l))+a*c))>n){p=!0;break}}else if("STEP"===e.getInterpolation()&&(t!==i||t!==a)){p=!0;break}}p&&(u!==a&&(s.setScalar(a,s.getScalar(u)),r.setElement(a,r.getElement(u,o))),a++)}var c;i>0&&(s.setScalar(a,s.getScalar(i)),r.setElement(a,r.getElement(i,o)),a++),a!==s.getCount()?(s.setArray(s.getArray().slice(0,a)),r.setArray(r.getArray().slice(0,a*r.getElementSize())),e.setInput(s),e.setOutput(r)):(s.dispose(),r.dispose())}const re={name:"",fps:10,pattern:/.*/,sort:!0};function ne(e=re){const t=T({},re,e);return e=>{const s=e.getLogger(),n=e.getRoot(),i=t.fps,o=n.listNodes().filter((e=>e.getName().match(t.pattern)));t.sort&&o.sort(((e,t)=>e.getName()>t.getName()?1:-1));const a=e.createAnimation(t.name),c=n.listBuffers()[0];o.forEach(((t,s)=>{let n,u;0===s?(n=[s/i,(s+1)/i],u=[1,1,1,0,0,0]):s===o.length-1?(n=[(s-1)/i,s/i],u=[0,0,0,1,1,1]):(n=[(s-1)/i,s/i,(s+1)/i],u=[0,0,0,1,1,1,0,0,0]);const h=e.createAccessor().setArray(new Float32Array(n)).setBuffer(c),l=e.createAccessor().setArray(new Float32Array(u)).setBuffer(c).setType(r.Accessor.Type.VEC3),p=e.createAnimationSampler().setInterpolation(r.AnimationSampler.Interpolation.STEP).setInput(h).setOutput(l),f=e.createAnimationChannel().setTargetNode(t).setTargetPath(r.AnimationChannel.TargetPath.SCALE).setSampler(p);a.addSampler(p).addChannel(f)})),s.debug("sequence: Complete.")}}const ie={overwrite:!1};function oe(e=ie){if(!e.generateTangents)throw new Error('tangents: generateTangents callback required \u2014 install "mikktspace".');const t=T({},ie,e);return e=>{const s=e.getLogger(),n=new Map,i=new Map;let o=0;for(const a of e.getRoot().listMeshes()){const c=a.getName(),u=a.listPrimitives();for(let a=0;a<u.length;a++){const h=u[a];if(!ae(h,s,c,a,t.overwrite))continue;const l=h.getAttribute("POSITION").getArray(),p=h.getAttribute("NORMAL").getArray(),f=h.getAttribute("TEXCOORD_0").getArray(),g=n.get(l)||Object(r.uuid)();n.set(l,g);const d=n.get(p)||Object(r.uuid)();n.set(p,d);const m=n.get(f)||Object(r.uuid)();n.set(f,m);const x=h.getAttribute("TANGENT");x&&2===x.listParents().length&&x.dispose();const T=`${g}|${d}|${m}`;let y=i.get(T);if(y){s.debug(`tangents: Found cache for primitive ${a} of mesh "${c}".`),h.setAttribute("TANGENT",y),o++;continue}s.debug(`tangents: Generating for primitive ${a} of mesh "${c}".`);const E=h.getAttribute("POSITION").getBuffer(),b=t.generateTangents(l instanceof Float32Array?l:new Float32Array(l),p instanceof Float32Array?p:new Float32Array(p),f instanceof Float32Array?f:new Float32Array(f));for(let e=3;e<b.length;e+=4)b[e]*=-1;y=e.createAccessor().setBuffer(E).setArray(b).setType("VEC4"),h.setAttribute("TANGENT",y),i.set(T,y),o++}}o?s.debug("tangents: Complete."):s.warn("tangents: No qualifying primitives found. See debug output.")}}function ae(e,t,s,n,i){return e.getMode()===r.Primitive.Mode.TRIANGLES&&e.getAttribute("POSITION")&&e.getAttribute("NORMAL")&&e.getAttribute("TEXCOORD_0")?e.getAttribute("TANGENT")&&!i?(t.debug(`tangents: Skipping primitive ${n} of mesh "${s}": TANGENT found.`),!1):!e.getIndices()||(t.warn(`tangents: Skipping primitive ${n} of mesh "${s}": primitives must be unwelded.`),!1):(t.debug(`tangents: Skipping primitive ${n} of mesh "${s}": primitives must have attributes=[POSITION, NORMAL, TEXCOORD_0] and mode=TRIANGLES.`),!1)}const ce="textureResize";var ue,he;(he=ue||(ue={})).LANCZOS3="lanczos3",he.LANCZOS2="lanczos2";const le={size:[2048,2048],filter:ue.LANCZOS3,pattern:null};function pe(e=le){const t=T({},le,e);return async e=>{const s=e.getLogger();for(const r of e.getRoot().listTextures()){const e=r.getName(),i=r.getURI();if(t.pattern&&!t.pattern.test(e)&&!t.pattern.test(i))continue;if("image/png"!==r.getMimeType()&&"image/jpeg"!==r.getMimeType()){s.warn(`Skipping unsupported texture type, "${r.getMimeType()}".`);continue}const[o,c]=t.size,[u,h]=r.getSize();if(u<=o&&h<=c){s.debug(`${ce}: Skipping "${i||e}", within size range.`);continue}let l=u,p=h;l>o&&(l=o,p=Math.floor(p*(l/u))),p>c&&(p=c,l=Math.floor(l*(p/h)));const f=new Uint8Array(r.getImage()),g=await Object(n.a)(f,r.getMimeType()),d=a()(new Uint8Array(l*p*4),[l,p,4]);s.debug(`${ce}: Resizing "${i||e}", ${g.shape} \u2192 ${d.shape}...`);try{t.filter===ue.LANCZOS3?m(g,d):x(g,d)}catch(t){s.warn(`${ce}: Failed to resize "${i||e}": "${t.message}".`);continue}r.setImage((await Object(n.b)(d,r.getMimeType())).buffer)}s.debug(`${ce}: Complete.`)}}const fe={};function ge(e=fe){return T({},fe,e),e=>{const t=e.getLogger(),s=new Map;for(const r of e.getRoot().listMeshes())for(const e of r.listPrimitives()){const r=e.getIndices();if(r){for(const n of e.listAttributes())e.swap(n,de(n,r,t,s)),1===n.listParents().length&&n.dispose();for(const n of e.listTargets())for(const e of n.listAttributes())n.swap(e,de(e,r,t,s)),1===e.listParents().length&&e.dispose();e.setIndices(null),1===r.listParents().length&&r.dispose()}}t.debug("unweld: Complete.")}}function de(e,t,s,r){if(r.has(e)&&r.get(e).has(t))return s.debug(`unweld: Cache hit for reused attribute, "${e.getName()}".`),r.get(e).get(t);const n=e.clone(),i=e.getArray().constructor;n.setArray(new i(t.getCount()*e.getElementSize()));const o=[];for(let a=0;a<t.getCount();a++)n.setElement(a,e.getElement(t.getScalar(a),o));return r.has(e)||r.set(e,new Map),r.get(e).set(t,n),n}const me={tolerance:1e-4};function xe(e=me){const t=T({},me,e);return e=>{const s=e.getLogger();for(const r of e.getRoot().listMeshes())for(const s of r.listPrimitives())0===t.tolerance?Te(e,s):ye(e,s,t);s.debug("weld: Complete.")}}function Te(e,t){if(t.getIndices())return;const s=t.listAttributes()[0],n=s.getCount(),i=s.getBuffer(),o=n<=65534?new Uint16Array(3*A(t)):new Uint32Array(3*A(t)),a=e.createAccessor().setBuffer(i).setType(r.Accessor.Type.SCALAR).setArray(o);for(let r=0;r<a.getCount();r++)a.setScalar(r,r);t.setIndices(a)}function ye(e,t,s){const r=Math.max(s.tolerance,Number.EPSILON),n=Math.log10(1/r),i=Math.pow(10,n),o={},a=t.getIndices(),c=a?a.getCount():t.listAttributes()[0].getCount(),u=new Map;t.listAttributes().forEach((e=>u.set(e,[]))),t.listTargets().forEach((e=>{e.listAttributes().forEach((e=>u.set(e,[])))}));const h=[];let l=0;for(let g=0;g<c;g++){const e=a?a.getScalar(g):g,s=[],r=[];for(const o of t.listAttributes())for(let t=0;t<o.getElementSize();t++)s.push(~~(o.getElement(e,r)[t]*i));const n=s.join("|");if(n in o)h.push(o[n]);else{for(const s of t.listAttributes())u.get(s).push(s.getElement(e,[]));for(const s of t.listTargets())for(const t of s.listAttributes())u.get(t).push(t.getElement(e,[]));o[n]=l,h.push(l),l++}}const p=t.listAttributes()[0].getCount(),f=u.get(t.getAttribute("POSITION")).length;e.getLogger().debug(`weld: ${p} \u2192 ${f} vertices.`);for(const g of t.listAttributes())be(t,g,u.get(g)),1===g.listParents().length&&g.dispose();for(const g of t.listTargets())for(const e of g.listAttributes())be(g,e,u.get(e)),1===e.listParents().length&&e.dispose();if(a){const e=Ee(a.getArray(),h.length);e.set(h),t.setIndices(a.clone().setArray(e)),1===a.listParents().length&&a.dispose()}else{const s=p<=65534?new Uint16Array(h):new Uint32Array(h);t.setIndices(e.createAccessor().setArray(s))}}function Ee(e,t){return new(0,e.constructor)(t)}function be(e,t,s){const r=s.length*t.getElementSize(),n=Ee(t.getArray(),r),i=t.clone().setArray(n);for(let o=0;o<s.length;o++)i.setElement(o,s[o]);e.swap(t,i)}},Ytbt:function(e,t,s){"use strict";var r=s("QM7d"),n={body:"",args:[],thisVars:[],localVars:[]};function i(e){if(!e)return n;for(var t=0;t<e.args.length;++t){var s=e.args[t];e.args[t]=0===t?{name:s,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:s,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function o(e){for(var t=[],s=0;s<e.args.length;++s)t.push("a"+s);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return r({args:e.args,pre:i(e.pre),body:i(e.body),post:i(e.proc),funcName:e.funcName})}(e))}var a={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in a){var s=a[e];t[e]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+s+"c"},funcName:e}),t[e+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a"+s+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+s+"s"},funcName:e+"s"}),t[e+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a"+s+"=s"},rvalue:!0,funcName:e+"seq"})}}();var c={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in c){var s=c[e];t[e]=o({args:["array","array"],body:{args:["a","b"],body:"a="+s+"b"},funcName:e}),t[e+"eq"]=o({args:["array"],body:{args:["a"],body:"a="+s+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var u={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in u){var s=u[e];t[e]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+s+"c"},funcName:e}),t[e+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+s+"s"},funcName:e+"s"}),t[e+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a=a"+s+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+s+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var h=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<h.length;++e){var s=h[e];t[s]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+s,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:s}),t[s+"eq"]=o({args:["array"],pre:{args:[],body:"this_f=Math."+s,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:s+"eq"})}}();var l=["max","min","atan2","pow"];!function(){for(var e=0;e<l.length;++e){var s=l[e];t[s]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+s,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:s}),t[s+"s"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+s,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:s+"s"}),t[s+"eq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+s,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:s+"eq"}),t[s+"seq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+s,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:s+"seq"})}}();var p=["atan2","pow"];!function(){for(var e=0;e<p.length;++e){var s=p[e];t[s+"op"]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+s,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:s+"op"}),t[s+"ops"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+s,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:s+"ops"}),t[s+"opeq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+s,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:s+"opeq"}),t[s+"opseq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+s,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:s+"opseq"})}}(),t.any=r({args:["array"],pre:n,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=r({args:["array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=r({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=r({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=r({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=r({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=o({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=o({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=o({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=r({args:["array","array"],pre:n,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},ZUXO:function(e,t,s){"use strict";s.r(t),s.d(t,"ALL_EXTENSIONS",(function(){return Ge})),s.d(t,"Clearcoat",(function(){return V})),s.d(t,"DracoMeshCompression",(function(){return F})),s.d(t,"IOR",(function(){return H})),s.d(t,"InstancedMesh",(function(){return o})),s.d(t,"KHRONOS_EXTENSIONS",(function(){return De})),s.d(t,"Light",(function(){return L})),s.d(t,"LightsPunctual",(function(){return k})),s.d(t,"Mapping",(function(){return Ce})),s.d(t,"MappingList",(function(){return _e})),s.d(t,"MaterialsClearcoat",(function(){return q})),s.d(t,"MaterialsIOR",(function(){return X})),s.d(t,"MaterialsPBRSpecularGlossiness",(function(){return ee})),s.d(t,"MaterialsSheen",(function(){return ae})),s.d(t,"MaterialsSpecular",(function(){return ge})),s.d(t,"MaterialsTransmission",(function(){return Te})),s.d(t,"MaterialsUnlit",(function(){return be})),s.d(t,"MaterialsVariants",(function(){return Se})),s.d(t,"MaterialsVolume",(function(){return Re})),s.d(t,"MeshGPUInstancing",(function(){return c})),s.d(t,"MeshQuantization",(function(){return Oe})),s.d(t,"MeshoptCompression",(function(){return f})),s.d(t,"PBRSpecularGlossiness",(function(){return Z})),s.d(t,"Sheen",(function(){return ie})),s.d(t,"Specular",(function(){return pe})),s.d(t,"TextureBasisu",(function(){return Pe})),s.d(t,"TextureTransform",(function(){return ke})),s.d(t,"TextureWebP",(function(){return m})),s.d(t,"Transform",(function(){return Le})),s.d(t,"Transmission",(function(){return me})),s.d(t,"Unlit",(function(){return ye})),s.d(t,"Variant",(function(){return Ie})),s.d(t,"Volume",(function(){return Ne}));var r=s("Nt23"),n=s("noPr");function i(e,t,s,r){var n,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i<3?n(o):i>3?n(t,s,o):n(t,s))||o);return i>3&&o&&Object.defineProperty(t,s,o),o}class o extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="InstancedMesh",this.parentTypes=[r.PropertyType.NODE],this.extensionName="EXT_mesh_gpu_instancing",this.attributes=[]}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this.clearGraphChildList(this.attributes),e.listSemantics().forEach((s=>{this.setAttribute(s,t(e.getAttribute(s)))})),this}getAttribute(e){const t=this.attributes.find((t=>t.semantic===e));return t?t.getChild():null}setAttribute(e,t){const s=this.getAttribute(e);if(s&&this.removeGraphChild(this.attributes,s),!t)return this;const r=this.graph.linkAttribute(e.toLowerCase(),this,t);return r.semantic=e,this.addGraphChild(this.attributes,r)}listAttributes(){return this.attributes.map((e=>e.getChild()))}listSemantics(){return this.attributes.map((e=>e.semantic))}}o.EXTENSION_NAME="EXT_mesh_gpu_instancing",i([r.GraphChildList],o.prototype,"attributes",void 0);const a="EXT_mesh_gpu_instancing";class c extends r.Extension{constructor(...e){super(...e),this.extensionName=a,this.provideTypes=[r.PropertyType.NODE],this.prewriteTypes=[r.PropertyType.ACCESSOR]}createInstancedMesh(){return new o(this.doc.getGraph(),this)}read(e){return(e.jsonDoc.json.nodes||[]).forEach(((t,s)=>{if(!t.extensions||!t.extensions[a])return;const r=t.extensions[a],n=this.createInstancedMesh();for(const i in r.attributes)n.setAttribute(i,e.accessors[r.attributes[i]]);e.nodes[s].setExtension(a,n)})),this}prewrite(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const t of this.properties)for(const s of t.listAttributes())e.setAccessorUsage(s,"INSTANCE_ATTRIBUTE");return this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listNodes().forEach((s=>{const r=s.getExtension(a);if(r){const n=e.nodeIndexMap.get(s),i=t.json.nodes[n],o={attributes:{}};r.listSemantics().forEach((t=>{const s=r.getAttribute(t);o.attributes[t]=e.accessorIndexMap.get(s)})),i.extensions=i.extensions||{},i.extensions[a]=o}})),this}}c.EXTENSION_NAME=a;const u="EXT_meshopt_compression";var h,l,p;(p=h||(h={})).ATTRIBUTES="ATTRIBUTES",p.TRIANGLES="TRIANGLES",p.INDICES="INDICES",function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(l||(l={}));class f extends r.Extension{constructor(...e){super(...e),this.extensionName=u,this.prereadTypes=[r.PropertyType.BUFFER,r.PropertyType.PRIMITIVE],this.readDependencies=["meshopt.decoder"],this._decoder=null,this._fallbackBufferMap=new Map}install(e,t){return"meshopt.decoder"===e&&(this._decoder=t),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${u}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${u}]: Missing WASM support.`)}return t===r.PropertyType.BUFFER?this._beforeBuffers(e):t===r.PropertyType.PRIMITIVE&&this._beforePrimitives(e),this}_beforeBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(((s,n)=>{if(!s.extensions||!s.extensions[u])return;const i=s.extensions[u],o=i.byteOffset||0,a=i.byteLength||0,c=i.count,h=i.byteStride,l=new Uint8Array(new ArrayBuffer(c*h)),p=t.json.buffers[s.buffer],f=new Uint8Array(p.uri?t.resources[p.uri]:t.resources[r.GLB_BUFFER],o,a);this._decoder.decodeGltfBuffer(l,c,h,f,i.mode,i.filter),e.bufferViews[n]=l}))}_beforePrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((s=>{var r;s.extensions&&s.extensions[u]&&(r=t.json.buffers[s.buffer]).extensions&&r.extensions[u]&&r.extensions[u].fallback&&this._fallbackBufferMap.set(e.buffers[s.buffer],e.buffers[s.extensions[u].buffer])}))}read(e){if(!this.isRequired())return this;for(const[t,s]of this._fallbackBufferMap){for(const e of t.listParents())e instanceof r.Accessor&&e.swap(t,s);t.dispose()}return this}write(e){return this.doc.getLogger().warn(`Writing ${this.extensionName} not yet implemented.`),this}}f.EXTENSION_NAME=u;const g="EXT_texture_webp";class d{getSize(e){const t=r.BufferUtils.decodeText(e.slice(0,4)),s=r.BufferUtils.decodeText(e.slice(8,12));if("RIFF"!==t||"WEBP"!==s)return null;const n=new DataView(e);let i=12;for(;i<e.byteLength;){const t=r.BufferUtils.decodeText(e.slice(i,i+4)),s=n.getUint32(i+4,!0);if("VP8 "===t)return[16383&n.getInt16(i+14,!0),16383&n.getInt16(i+16,!0)];if("VP8L"===t){const e=n.getUint8(i+9),t=n.getUint8(i+10),s=n.getUint8(i+11);return[1+((63&t)<<8|e),1+((15&n.getUint8(i+12))<<10|s<<2|(192&t)>>6)]}i+=8+s+s%2}return null}getChannels(e){return 4}}class m extends r.Extension{constructor(...e){super(...e),this.extensionName=g,this.prereadTypes=[r.PropertyType.TEXTURE]}static register(){r.ImageUtils.registerFormat("image/webp",new d)}preread(e){return(e.jsonDoc.json.textures||[]).forEach((e=>{e.extensions&&e.extensions[g]&&(e.source=e.extensions[g].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listTextures().forEach((s=>{if("image/webp"===s.getMimeType()){const r=e.imageIndexMap.get(s);(t.json.textures||[]).forEach((e=>{e.source===r&&(e.extensions=e.extensions||{},e.extensions[g]={source:e.source},delete e.source)}))}})),this}}function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e}).apply(this,arguments)}m.EXTENSION_NAME=g;const T="KHR_draco_mesh_compression";let y,E,b,C;function _(e,t){const s=new y.DecoderBuffer;try{if(s.Init(t,t.length),e.GetEncodedGeometryType(s)!==y.TRIANGULAR_MESH)throw new Error(`[${T}] Unknown geometry type.`);const r=new y.Mesh;if(!e.DecodeBufferToMesh(s,r).ok()||0===r.ptr)throw new Error(`[${T}] Decoding failure.`);return r}finally{y.destroy(s)}}function I(e,t){const s=3*t.num_faces();let r,n;if(t.num_points()<=65534){const i=s*Uint16Array.BYTES_PER_ELEMENT;r=y._malloc(i),e.GetTrianglesUInt16Array(t,i,r),n=new Uint16Array(y.HEAPU16.buffer,r,s).slice()}else{const i=s*Uint32Array.BYTES_PER_ELEMENT;r=y._malloc(i),e.GetTrianglesUInt32Array(t,i,r),n=new Uint32Array(y.HEAPU32.buffer,r,s).slice()}return y._free(r),n}function A(e,t,s,r){const n=b[r.componentType],i=E[r.componentType],o=s.num_components(),a=t.num_points()*o,c=a*i.BYTES_PER_ELEMENT,u=y._malloc(c);e.GetAttributeDataArrayForAllPoints(t,s,n,c,u);const h=new i(y.HEAPF32.buffer,u,a).slice();return y._free(u),h}var S,v;!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(S||(S={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(v||(v={}));const N={[v.POSITION]:14,[v.NORMAL]:10,[v.COLOR]:8,[v.TEX_COORD]:12,[v.GENERIC]:12},w={decodeSpeed:5,encodeSpeed:5,method:S.EDGEBREAKER,quantizationBits:N,quantizationVolume:"mesh"};function R(e,t=w){const s=x({},w,t);s.quantizationBits=x({},N,t.quantizationBits);const r=new C.Encoder,n=new C.MeshBuilder,i=new C.Mesh,o={},a=new C.DracoInt8Array;for(const f of e.listSemantics()){const t=e.getAttribute(f),a=M(f),c=O(n,t.getComponentType(),i,C[a],t.getCount(),t.getElementSize(),t.getArray());if(-1===c)throw new Error(`Error compressing "${f}" attribute.`);if(o[f]=c,"mesh"===s.quantizationVolume||"POSITION"!==f)r.SetAttributeQuantization(C[a],s.quantizationBits[a]);else{if("object"!=typeof s.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:e}=s,n=Math.max(e.max[0]-e.min[0],e.max[1]-e.min[1],e.max[2]-e.min[2]);r.SetAttributeExplicitQuantization(C[a],s.quantizationBits[a],t.getElementSize(),e.min,n)}}}const c=e.getIndices();if(!c)throw new Error("Primitive must have indices.");n.AddFacesToMesh(i,c.getCount()/3,c.getArray()),r.SetSpeedOptions(s.encodeSpeed,s.decodeSpeed),r.SetTrackEncodedProperties(!0),e.listTargets().length>0||s.method===S.SEQUENTIAL?r.SetEncodingMethod(C.MESH_SEQUENTIAL_ENCODING):r.SetEncodingMethod(C.MESH_EDGEBREAKER_ENCODING);const u=r.EncodeMeshToDracoBuffer(i,a);if(u<=0)throw new Error("Error applying Draco compression.");const h=new Uint8Array(u);for(let f=0;f<u;++f)h[f]=a.GetValue(f);const l=r.GetNumberOfEncodedPoints(),p=3*r.GetNumberOfEncodedFaces();return C.destroy(a),C.destroy(i),C.destroy(n),C.destroy(r),{numVertices:l,numIndices:p,data:h,attributeIDs:o}}function M(e){return"POSITION"===e?v.POSITION:"NORMAL"===e?v.NORMAL:e.startsWith("COLOR_")?v.COLOR:e.startsWith("TEXCOORD_")?v.TEX_COORD:v.GENERIC}function O(e,t,s,n,i,o,a){switch(t){case r.Accessor.ComponentType.UNSIGNED_BYTE:return e.AddUInt8Attribute(s,n,i,o,a);case r.Accessor.ComponentType.BYTE:return e.AddInt8Attribute(s,n,i,o,a);case r.Accessor.ComponentType.UNSIGNED_SHORT:return e.AddUInt16Attribute(s,n,i,o,a);case r.Accessor.ComponentType.SHORT:return e.AddInt16Attribute(s,n,i,o,a);case r.Accessor.ComponentType.UNSIGNED_INT:return e.AddUInt32Attribute(s,n,i,o,a);case r.Accessor.ComponentType.FLOAT:return e.AddFloatAttribute(s,n,i,o,a);default:throw new Error(`Unexpected component type, "${t}".`)}}const U="KHR_draco_mesh_compression";class F extends r.Extension{constructor(...e){super(...e),this.extensionName=U,this.prereadTypes=[r.PropertyType.PRIMITIVE],this.prewriteTypes=[r.PropertyType.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return"draco3d.decoder"===e&&(this._decoderModule=t,y=this._decoderModule,E={[r.Accessor.ComponentType.FLOAT]:Float32Array,[r.Accessor.ComponentType.UNSIGNED_INT]:Uint32Array,[r.Accessor.ComponentType.UNSIGNED_SHORT]:Uint16Array,[r.Accessor.ComponentType.UNSIGNED_BYTE]:Uint8Array,[r.Accessor.ComponentType.SHORT]:Int16Array,[r.Accessor.ComponentType.BYTE]:Int8Array},b={[r.Accessor.ComponentType.FLOAT]:y.DT_FLOAT32,[r.Accessor.ComponentType.UNSIGNED_INT]:y.DT_UINT32,[r.Accessor.ComponentType.UNSIGNED_SHORT]:y.DT_UINT16,[r.Accessor.ComponentType.UNSIGNED_BYTE]:y.DT_UINT8,[r.Accessor.ComponentType.SHORT]:y.DT_INT16,[r.Accessor.ComponentType.BYTE]:y.DT_INT8}),"draco3d.encoder"===e&&(this._encoderModule=t,C=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${U}] Please install extension dependency, "draco3d.decoder".`);const t=this.doc.getLogger(),s=e.jsonDoc,n=new Map;try{const i=s.json.meshes||[];for(const o of i)for(const i of o.primitives){if(!i.extensions||!i.extensions[U])continue;const o=i.extensions[U];let[a,c]=n.get(o.bufferView)||[];if(!c||!a){const e=s.json.bufferViews[o.bufferView],i=s.json.buffers[e.buffer],u=new Int8Array(i.uri?s.resources[i.uri]:s.resources[r.GLB_BUFFER],e.byteOffset||0,e.byteLength);a=new this._decoderModule.Decoder,c=_(a,u),n.set(o.bufferView,[a,c]),t.debug(`[${U}] Decompressed ${u.byteLength} bytes.`)}for(const t in i.attributes){const s=e.jsonDoc.json.accessors[i.attributes[t]],r=a.GetAttributeByUniqueId(c,o.attributes[t]),n=A(a,c,r,s);e.accessors[i.attributes[t]].setArray(n)}void 0!==i.indices&&e.accessors[i.indices].setArray(I(a,c))}}finally{for(const[e,t]of Array.from(n.values()))this._decoderModule.destroy(e),this._decoderModule.destroy(t)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${U}] Please install extension dependency, "draco3d.encoder".`);const s=this.doc.getLogger();s.debug(`[${U}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const n=function(e){const t=e.getLogger(),s=new Set,n=new Set;for(const h of e.getRoot().listMeshes())for(const e of h.listPrimitives())e.getIndices()?e.getMode()!==r.Primitive.Mode.TRIANGLES?(n.add(e),t.warn(`[${U}] Skipping Draco compression on non-TRIANGLES primitive.`)):s.add(e):(n.add(e),t.warn(`[${U}] Skipping Draco compression on non-indexed primitive.`));const i=e.getRoot().listAccessors(),o=new Map;for(let r=0;r<i.length;r++)o.set(i[r],r);const a=new Map,c=new Set,u=new Map;for(const r of Array.from(s)){let t=P(r,o);if(c.has(t))u.set(r,t);else{if(a.has(r.getIndices())){const t=r.getIndices(),s=t.clone();o.set(s,e.getRoot().listAccessors().length-1),r.swap(t,s)}for(const t of r.listAttributes())if(a.has(t)){const s=t.clone();o.set(s,e.getRoot().listAccessors().length-1),r.swap(t,s)}t=P(r,o),c.add(t),u.set(r,t),a.set(r.getIndices(),t);for(const e of r.listAttributes())a.set(e,t)}}for(const r of Array.from(a.keys())){const e=new Set(r.listParents().map((e=>e.propertyType)));if(2!==e.size||!e.has("Primitive")||!e.has("Root"))throw new Error(`[${U}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const r of Array.from(s)){const e=u.get(r),t=r.getIndices();if(a.get(t)!==e||r.listAttributes().some((t=>a.get(t)!==e)))throw new Error(`[${U}] Draco primitives must share all, or no, accessors.`)}for(const r of Array.from(n)){const e=r.getIndices();if(a.has(e)||r.listAttributes().some((e=>a.has(e))))throw new Error(`[${U}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return u}(this.doc),i=new Map;let o="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.doc.getRoot().listScenes().length?s.warn(`[${U}]: quantizationVolume=scene requires exactly 1 scene.`):o=Object(r.bounds)(this.doc.getRoot().listScenes().pop()));for(const r of Array.from(n.keys())){const t=n.get(r);if(!t)throw new Error("Unexpected primitive.");if(i.has(t)){i.set(t,i.get(t));continue}const s=r.getIndices(),a=e.jsonDoc.json.accessors,c=R(r,x({},this._encoderOptions,{quantizationVolume:o}));i.set(t,c);const u=e.createAccessorDef(s);u.count=c.numIndices,e.accessorIndexMap.set(s,a.length),a.push(u);for(const n of r.listSemantics()){const t=r.getAttribute(n),s=e.createAccessorDef(t);s.count=c.numVertices,e.accessorIndexMap.set(t,a.length),a.push(s)}const h=r.getAttribute("POSITION").getBuffer()||this.doc.getRoot().listBuffers()[0];e.otherBufferViews.has(h)||e.otherBufferViews.set(h,[]),e.otherBufferViews.get(h).push(c.data)}return s.debug(`[${U}] Compressed ${n.size} primitives.`),e.extensionData[U]={primitiveHashMap:n,primitiveEncodingMap:i},this}write(e){const t=e.extensionData[U];for(const s of this.doc.getRoot().listMeshes()){const r=e.jsonDoc.json.meshes[e.meshIndexMap.get(s)];for(let n=0;n<s.listPrimitives().length;n++){const i=s.listPrimitives()[n],o=r.primitives[n],a=t.primitiveHashMap.get(i);if(!a)continue;const c=t.primitiveEncodingMap.get(a);o.extensions=o.extensions||{},o.extensions[U]={bufferView:e.otherBufferViewsIndexMap.get(c.data),attributes:c.attributeIDs}}}if(!t.primitiveHashMap.size){const t=e.jsonDoc.json;t.extensionsUsed=(t.extensionsUsed||[]).filter((e=>e!==U)),t.extensionsRequired=(t.extensionsRequired||[]).filter((e=>e!==U))}return this}}function P(e,t){const s=[],r=e.getIndices();s.push(t.get(r));for(const n of e.listAttributes())s.push(t.get(n));return s.sort().join("|")}F.EXTENSION_NAME=U,F.EncoderMethod=S;class L extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="Light",this.parentTypes=[r.PropertyType.NODE],this.extensionName="KHR_lights_punctual",this._color=[1,1,1],this._intensity=1,this._type=L.Type.POINT,this._range=null,this._innerConeAngle=0,this._outerConeAngle=Math.PI/4}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this._color=[...e._color],this._intensity=e._intensity,this._type=e._type,this._range=e._range,this._innerConeAngle=e._innerConeAngle,this._outerConeAngle=e._outerConeAngle,this}getColor(){return this._color}setColor(e){return this._color=e,this}getColorHex(){return r.ColorUtils.factorToHex(this._color)}setColorHex(e){return r.ColorUtils.hexToFactor(e,this._color),this}getIntensity(){return this._intensity}setIntensity(e){return this._intensity=e,this}getType(){return this._type}setType(e){return this._type=e,this}getRange(){return this._range}setRange(e){return this._range=e,this}getInnerConeAngle(){return this._innerConeAngle}setInnerConeAngle(e){return this._innerConeAngle=e,this}getOuterConeAngle(){return this._outerConeAngle}setOuterConeAngle(e){return this._outerConeAngle=e,this}}L.EXTENSION_NAME="KHR_lights_punctual",L.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const j="KHR_lights_punctual";class k extends r.Extension{constructor(...e){super(...e),this.extensionName=j}createLight(){return new L(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[j])return this;const s=(t.json.extensions[j].lights||[]).map((e=>{const t=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&t.setColor(e.color),void 0!==e.intensity&&t.setIntensity(e.intensity),void 0!==e.range&&t.setRange(e.range),void 0!==e.innerConeAngle&&t.setInnerConeAngle(e.innerConeAngle),void 0!==e.outerConeAngle&&t.setOuterConeAngle(e.outerConeAngle),t}));return t.json.nodes.forEach(((t,r)=>{t.extensions&&t.extensions[j]&&e.nodes[r].setExtension(j,s[t.extensions[j].light])})),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const s=[],n=new Map;for(const i of this.properties){const e=i,t={type:e.getType()};r.MathUtils.eq(e.getColor(),[1,1,1])||(t.color=e.getColor()),1!==e.getIntensity()&&(t.intensity=e.getIntensity()),null!=e.getRange()&&(t.range=e.getRange()),e.getName()&&(t.name=e.getName()),e.getType()===L.Type.SPOT&&(t.innerConeAngle=e.getInnerConeAngle(),t.outerConeAngle=e.getOuterConeAngle()),s.push(t),n.set(e,s.length-1)}return this.doc.getRoot().listNodes().forEach((s=>{const r=s.getExtension(j);if(r){const i=e.nodeIndexMap.get(s),o=t.json.nodes[i];o.extensions=o.extensions||{},o.extensions[j]={light:n.get(r)}}})),t.json.extensions=t.json.extensions||{},t.json.extensions[j]={lights:s},this}}k.EXTENSION_NAME=j;const{R:D,G:G,B:B}=r.TextureChannel;class V extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="Clearcoat",this.parentTypes=[r.PropertyType.MATERIAL],this.extensionName="KHR_materials_clearcoat",this._clearcoatFactor=0,this._clearcoatRoughnessFactor=0,this._clearcoatNormalScale=1,this.clearcoatTexture=null,this.clearcoatTextureInfo=this.graph.link("clearcoatTextureInfo",this,new r.TextureInfo(this.graph)),this.clearcoatRoughnessTexture=null,this.clearcoatRoughnessTextureInfo=this.graph.link("clearcoatRoughnessTextureInfo",this,new r.TextureInfo(this.graph)),this.clearcoatNormalTexture=null,this.clearcoatNormalTextureInfo=this.graph.link("clearcoatNormalTextureInfo",this,new r.TextureInfo(this.graph))}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this._clearcoatFactor=e._clearcoatFactor,this._clearcoatRoughnessFactor=e._clearcoatRoughnessFactor,this._clearcoatNormalScale=e._clearcoatNormalScale,this.setClearcoatTexture(e.clearcoatTexture?t(e.clearcoatTexture.getChild()):null),this.clearcoatTextureInfo.getChild().copy(t(e.clearcoatTextureInfo.getChild()),t),this.setClearcoatRoughnessTexture(e.clearcoatRoughnessTexture?t(e.clearcoatRoughnessTexture.getChild()):null),this.clearcoatRoughnessTextureInfo.getChild().copy(t(e.clearcoatRoughnessTextureInfo.getChild()),t),this.setClearcoatNormalTexture(e.clearcoatNormalTexture?t(e.clearcoatNormalTexture.getChild()):null),this.clearcoatNormalTextureInfo.getChild().copy(t(e.clearcoatNormalTextureInfo.getChild()),t),this}dispose(){this.clearcoatTextureInfo.getChild().dispose(),this.clearcoatRoughnessTextureInfo.getChild().dispose(),this.clearcoatNormalTextureInfo.getChild().dispose(),super.dispose()}getClearcoatFactor(){return this._clearcoatFactor}setClearcoatFactor(e){return this._clearcoatFactor=e,this}getClearcoatTexture(){return this.clearcoatTexture?this.clearcoatTexture.getChild():null}getClearcoatTextureInfo(){return this.clearcoatTexture?this.clearcoatTextureInfo.getChild():null}setClearcoatTexture(e){return this.clearcoatTexture=this.graph.linkTexture("clearcoatTexture",D,this,e),this}getClearcoatRoughnessFactor(){return this._clearcoatRoughnessFactor}setClearcoatRoughnessFactor(e){return this._clearcoatRoughnessFactor=e,this}getClearcoatRoughnessTexture(){return this.clearcoatRoughnessTexture?this.clearcoatRoughnessTexture.getChild():null}getClearcoatRoughnessTextureInfo(){return this.clearcoatRoughnessTexture?this.clearcoatRoughnessTextureInfo.getChild():null}setClearcoatRoughnessTexture(e){return this.clearcoatRoughnessTexture=this.graph.linkTexture("clearcoatRoughnessTexture",G,this,e),this}getClearcoatNormalScale(){return this._clearcoatNormalScale}setClearcoatNormalScale(e){return this._clearcoatNormalScale=e,this}getClearcoatNormalTexture(){return this.clearcoatNormalTexture?this.clearcoatNormalTexture.getChild():null}getClearcoatNormalTextureInfo(){return this.clearcoatNormalTexture?this.clearcoatNormalTextureInfo.getChild():null}setClearcoatNormalTexture(e){return this.clearcoatNormalTexture=this.graph.linkTexture("clearcoatNormalTexture",D|G|B,this,e),this}}V.EXTENSION_NAME="KHR_materials_clearcoat",i([r.GraphChild],V.prototype,"clearcoatTexture",void 0),i([r.GraphChild],V.prototype,"clearcoatTextureInfo",void 0),i([r.GraphChild],V.prototype,"clearcoatRoughnessTexture",void 0),i([r.GraphChild],V.prototype,"clearcoatRoughnessTextureInfo",void 0),i([r.GraphChild],V.prototype,"clearcoatNormalTexture",void 0),i([r.GraphChild],V.prototype,"clearcoatNormalTextureInfo",void 0);const z="KHR_materials_clearcoat";class q extends r.Extension{constructor(...e){super(...e),this.extensionName=z}createClearcoat(){return new V(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[z]){const n=this.createClearcoat();e.materials[r].setExtension(z,n);const i=t.extensions[z];if(void 0!==i.clearcoatFactor&&n.setClearcoatFactor(i.clearcoatFactor),void 0!==i.clearcoatRoughnessFactor&&n.setClearcoatRoughnessFactor(i.clearcoatRoughnessFactor),void 0!==i.clearcoatTexture){const t=i.clearcoatTexture;n.setClearcoatTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getClearcoatTextureInfo(),t)}if(void 0!==i.clearcoatRoughnessTexture){const t=i.clearcoatRoughnessTexture;n.setClearcoatRoughnessTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getClearcoatRoughnessTextureInfo(),t)}if(void 0!==i.clearcoatNormalTexture){const t=i.clearcoatNormalTexture;n.setClearcoatNormalTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getClearcoatNormalTextureInfo(),t),void 0!==t.scale&&n.setClearcoatNormalScale(t.scale)}}})),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(z);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{};const o=i.extensions[z]={clearcoatFactor:r.getClearcoatFactor(),clearcoatRoughnessFactor:r.getClearcoatRoughnessFactor()};if(r.getClearcoatTexture()){const t=r.getClearcoatTexture(),s=r.getClearcoatTextureInfo();o.clearcoatTexture=e.createTextureInfoDef(t,s)}if(r.getClearcoatRoughnessTexture()){const t=r.getClearcoatRoughnessTexture(),s=r.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=e.createTextureInfoDef(t,s)}if(r.getClearcoatNormalTexture()){const t=r.getClearcoatNormalTexture(),s=r.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=e.createTextureInfoDef(t,s),1!==r.getClearcoatNormalScale()&&(o.clearcoatNormalTexture.scale=r.getClearcoatNormalScale())}}})),this}}q.EXTENSION_NAME=z;class H extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="IOR",this.parentTypes=[r.PropertyType.MATERIAL],this.extensionName="KHR_materials_ior",this._ior=0}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this._ior=e._ior,this}getIOR(){return this._ior}setIOR(e){return this._ior=e,this}}H.EXTENSION_NAME="KHR_materials_ior";const $="KHR_materials_ior";class X extends r.Extension{constructor(...e){super(...e),this.extensionName=$}createIOR(){return new H(this.doc.getGraph(),this)}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,s)=>{if(t.extensions&&t.extensions[$]){const r=this.createIOR();e.materials[s].setExtension($,r);const n=t.extensions[$];void 0!==n.ior&&r.setIOR(n.ior)}})),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach((s=>{const r=s.getExtension($);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{},i.extensions[$]={ior:r.getIOR()}}})),this}}X.EXTENSION_NAME=$;const{R:Y,G:K,B:W,A:J}=r.TextureChannel;class Z extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="PBRSpecularGlossiness",this.parentTypes=[r.PropertyType.MATERIAL],this.extensionName="KHR_materials_pbrSpecularGlossiness",this._diffuseFactor=[1,1,1,1],this._specularFactor=[1,1,1],this._glossinessFactor=1,this.diffuseTexture=null,this.diffuseTextureInfo=this.graph.link("diffuseTextureInfo",this,new r.TextureInfo(this.graph)),this.specularGlossinessTexture=null,this.specularGlossinessTextureInfo=this.graph.link("specularGlossinessTextureInfo",this,new r.TextureInfo(this.graph))}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this._diffuseFactor=e._diffuseFactor,this._specularFactor=e._specularFactor,this._glossinessFactor=e._glossinessFactor,this.setDiffuseTexture(e.diffuseTexture?t(e.diffuseTexture.getChild()):null),this.diffuseTextureInfo.getChild().copy(t(e.diffuseTextureInfo.getChild()),t),this.setSpecularGlossinessTexture(e.specularGlossinessTexture?t(e.specularGlossinessTexture.getChild()):null),this.specularGlossinessTextureInfo.getChild().copy(t(e.specularGlossinessTextureInfo.getChild()),t),this}dispose(){this.diffuseTextureInfo.getChild().dispose(),this.specularGlossinessTextureInfo.getChild().dispose(),super.dispose()}getDiffuseFactor(){return this._diffuseFactor}setDiffuseFactor(e){return this._diffuseFactor=e,this}getDiffuseHex(){return r.ColorUtils.factorToHex(this._diffuseFactor)}setDiffuseHex(e){return r.ColorUtils.hexToFactor(e,this._diffuseFactor),this}getDiffuseTexture(){return this.diffuseTexture?this.diffuseTexture.getChild():null}getDiffuseTextureInfo(){return this.diffuseTexture?this.diffuseTextureInfo.getChild():null}setDiffuseTexture(e){return this.diffuseTexture=this.graph.linkTexture("diffuseTexture",Y|K|W|J,this,e),this}getSpecularFactor(){return this._specularFactor}setSpecularFactor(e){return this._specularFactor=e,this}getGlossinessFactor(){return this._glossinessFactor}setGlossinessFactor(e){return this._glossinessFactor=e,this}getSpecularGlossinessTexture(){return this.specularGlossinessTexture?this.specularGlossinessTexture.getChild():null}getSpecularGlossinessTextureInfo(){return this.specularGlossinessTexture?this.specularGlossinessTextureInfo.getChild():null}setSpecularGlossinessTexture(e){return this.specularGlossinessTexture=this.graph.linkTexture("specularGlossinessTexture",Y|K|W|J,this,e),this}}Z.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness",i([r.GraphChild],Z.prototype,"diffuseTexture",void 0),i([r.GraphChild],Z.prototype,"diffuseTextureInfo",void 0),i([r.GraphChild],Z.prototype,"specularGlossinessTexture",void 0),i([r.GraphChild],Z.prototype,"specularGlossinessTextureInfo",void 0);const Q="KHR_materials_pbrSpecularGlossiness";class ee extends r.Extension{constructor(...e){super(...e),this.extensionName=Q}createPBRSpecularGlossiness(){return new Z(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[Q]){const n=this.createPBRSpecularGlossiness();e.materials[r].setExtension(Q,n);const i=t.extensions[Q];if(void 0!==i.diffuseFactor&&n.setDiffuseFactor(i.diffuseFactor),void 0!==i.specularFactor&&n.setSpecularFactor(i.specularFactor),void 0!==i.glossinessFactor&&n.setGlossinessFactor(i.glossinessFactor),void 0!==i.diffuseTexture){const t=i.diffuseTexture;n.setDiffuseTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getDiffuseTextureInfo(),t)}if(void 0!==i.specularGlossinessTexture){const t=i.specularGlossinessTexture;n.setSpecularGlossinessTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getSpecularGlossinessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(Q);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{};const o=i.extensions[Q]={diffuseFactor:r.getDiffuseFactor(),specularFactor:r.getSpecularFactor(),glossinessFactor:r.getGlossinessFactor()};if(r.getDiffuseTexture()){const t=r.getDiffuseTexture(),s=r.getDiffuseTextureInfo();o.diffuseTexture=e.createTextureInfoDef(t,s)}if(r.getSpecularGlossinessTexture()){const t=r.getSpecularGlossinessTexture(),s=r.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=e.createTextureInfoDef(t,s)}}})),this}}ee.EXTENSION_NAME=Q;const{R:te,G:se,B:re,A:ne}=r.TextureChannel;class ie extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="Sheen",this.parentTypes=[r.PropertyType.MATERIAL],this.extensionName="KHR_materials_sheen",this._sheenColorFactor=[0,0,0],this._sheenRoughnessFactor=0,this.sheenColorTexture=null,this.sheenColorTextureInfo=this.graph.link("sheenColorTextureInfo",this,new r.TextureInfo(this.graph)),this.sheenRoughnessTexture=null,this.sheenRoughnessTextureInfo=this.graph.link("sheenRoughnessTextureInfo",this,new r.TextureInfo(this.graph))}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this._sheenColorFactor=e._sheenColorFactor,this._sheenRoughnessFactor=e._sheenRoughnessFactor,this.setSheenColorTexture(e.sheenColorTexture?t(e.sheenColorTexture.getChild()):null),this.sheenColorTextureInfo.getChild().copy(t(e.sheenColorTextureInfo.getChild()),t),this.setSheenRoughnessTexture(e.sheenRoughnessTexture?t(e.sheenRoughnessTexture.getChild()):null),this.sheenRoughnessTextureInfo.getChild().copy(t(e.sheenRoughnessTextureInfo.getChild()),t),this}dispose(){this.sheenColorTextureInfo.getChild().dispose(),this.sheenRoughnessTextureInfo.getChild().dispose(),super.dispose()}getSheenColorFactor(){return this._sheenColorFactor}getSheenColorHex(){return r.ColorUtils.factorToHex(this._sheenColorFactor)}setSheenColorFactor(e){return this._sheenColorFactor=e,this}setSheenColorHex(e){return r.ColorUtils.hexToFactor(e,this._sheenColorFactor),this}getSheenColorTexture(){return this.sheenColorTexture?this.sheenColorTexture.getChild():null}getSheenColorTextureInfo(){return this.sheenColorTexture?this.sheenColorTextureInfo.getChild():null}setSheenColorTexture(e){return this.sheenColorTexture=this.graph.linkTexture("sheenColorTexture",te|se|re,this,e),this}getSheenRoughnessFactor(){return this._sheenRoughnessFactor}setSheenRoughnessFactor(e){return this._sheenRoughnessFactor=e,this}getSheenRoughnessTexture(){return this.sheenRoughnessTexture?this.sheenRoughnessTexture.getChild():null}getSheenRoughnessTextureInfo(){return this.sheenRoughnessTexture?this.sheenRoughnessTextureInfo.getChild():null}setSheenRoughnessTexture(e){return this.sheenRoughnessTexture=this.graph.linkTexture("sheenRoughnessTexture",ne,this,e),this}}ie.EXTENSION_NAME="KHR_materials_sheen",i([r.GraphChild],ie.prototype,"sheenColorTexture",void 0),i([r.GraphChild],ie.prototype,"sheenColorTextureInfo",void 0),i([r.GraphChild],ie.prototype,"sheenRoughnessTexture",void 0),i([r.GraphChild],ie.prototype,"sheenRoughnessTextureInfo",void 0);const oe="KHR_materials_sheen";class ae extends r.Extension{constructor(...e){super(...e),this.extensionName=oe}createSheen(){return new ie(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[oe]){const n=this.createSheen();e.materials[r].setExtension(oe,n);const i=t.extensions[oe];if(void 0!==i.sheenColorFactor&&n.setSheenColorFactor(i.sheenColorFactor),void 0!==i.sheenRoughnessFactor&&n.setSheenRoughnessFactor(i.sheenRoughnessFactor),void 0!==i.sheenColorTexture){const t=i.sheenColorTexture;n.setSheenColorTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getSheenColorTextureInfo(),t)}if(void 0!==i.sheenRoughnessTexture){const t=i.sheenRoughnessTexture;n.setSheenRoughnessTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getSheenRoughnessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(oe);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{};const o=i.extensions[oe]={sheenColorFactor:r.getSheenColorFactor(),sheenRoughnessFactor:r.getSheenRoughnessFactor()};if(r.getSheenColorTexture()){const t=r.getSheenColorTexture(),s=r.getSheenColorTextureInfo();o.sheenColorTexture=e.createTextureInfoDef(t,s)}if(r.getSheenRoughnessTexture()){const t=r.getSheenRoughnessTexture(),s=r.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=e.createTextureInfoDef(t,s)}}})),this}}ae.EXTENSION_NAME=oe;const{R:ce,G:ue,B:he,A:le}=r.TextureChannel;class pe extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="Specular",this.parentTypes=[r.PropertyType.MATERIAL],this.extensionName="KHR_materials_specular",this._specularFactor=1,this._specularColorFactor=[1,1,1],this.specularTexture=null,this.specularTextureInfo=this.graph.link("specularTextureInfo",this,new r.TextureInfo(this.graph)),this.specularColorTexture=null,this.specularColorTextureInfo=this.graph.link("specularColorTextureInfo",this,new r.TextureInfo(this.graph))}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this._specularFactor=e._specularFactor,this._specularColorFactor=e._specularColorFactor,this.setSpecularTexture(e.specularTexture?t(e.specularTexture.getChild()):null),this.specularTextureInfo.getChild().copy(t(e.specularTextureInfo.getChild()),t),this.setSpecularColorTexture(e.specularColorTexture?t(e.specularColorTexture.getChild()):null),this.specularColorTextureInfo.getChild().copy(t(e.specularColorTextureInfo.getChild()),t),this}dispose(){this.specularTextureInfo.getChild().dispose(),super.dispose()}getSpecularFactor(){return this._specularFactor}setSpecularFactor(e){return this._specularFactor=e,this}getSpecularColorFactor(){return this._specularColorFactor}setSpecularColorFactor(e){return this._specularColorFactor=e,this}getSpecularColorHex(){return r.ColorUtils.factorToHex(this._specularColorFactor)}setSpecularColorHex(e){return r.ColorUtils.hexToFactor(e,this._specularColorFactor),this}getSpecularTexture(){return this.specularTexture?this.specularTexture.getChild():null}getSpecularTextureInfo(){return this.specularTexture?this.specularTextureInfo.getChild():null}setSpecularTexture(e){return this.specularTexture=this.graph.linkTexture("specularTexture",le,this,e),this}getSpecularColorTexture(){return this.specularColorTexture?this.specularColorTexture.getChild():null}getSpecularColorTextureInfo(){return this.specularColorTexture?this.specularColorTextureInfo.getChild():null}setSpecularColorTexture(e){return this.specularColorTexture=this.graph.linkTexture("specularColorTexture",ce|ue|he,this,e),this}}pe.EXTENSION_NAME="KHR_materials_specular",i([r.GraphChild],pe.prototype,"specularTexture",void 0),i([r.GraphChild],pe.prototype,"specularTextureInfo",void 0),i([r.GraphChild],pe.prototype,"specularColorTexture",void 0),i([r.GraphChild],pe.prototype,"specularColorTextureInfo",void 0);const fe="KHR_materials_specular";class ge extends r.Extension{constructor(...e){super(...e),this.extensionName=fe}createSpecular(){return new pe(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[fe]){const n=this.createSpecular();e.materials[r].setExtension(fe,n);const i=t.extensions[fe];if(void 0!==i.specularFactor&&n.setSpecularFactor(i.specularFactor),void 0!==i.specularColorFactor&&n.setSpecularColorFactor(i.specularColorFactor),void 0!==i.specularTexture){const t=i.specularTexture;n.setSpecularTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getSpecularTextureInfo(),t)}if(void 0!==i.specularColorTexture){const t=i.specularColorTexture;n.setSpecularColorTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getSpecularColorTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach((s=>{const n=s.getExtension(fe);if(n){const i=e.materialIndexMap.get(s),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[fe]={};if(1!==n.getSpecularFactor()&&(a.specularFactor=n.getSpecularFactor()),r.MathUtils.eq(n.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=n.getSpecularColorFactor()),n.getSpecularTexture()){const t=n.getSpecularTexture(),s=n.getSpecularTextureInfo();a.specularTexture=e.createTextureInfoDef(t,s)}if(n.getSpecularColorTexture()){const t=n.getSpecularColorTexture(),s=n.getSpecularColorTextureInfo();a.specularColorTexture=e.createTextureInfoDef(t,s)}}})),this}}ge.EXTENSION_NAME=fe;const{R:de}=r.TextureChannel;class me extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="Transmission",this.parentTypes=[r.PropertyType.MATERIAL],this.extensionName="KHR_materials_transmission",this._transmissionFactor=0,this.transmissionTexture=null,this.transmissionTextureInfo=this.graph.link("transmissionTextureInfo",this,new r.TextureInfo(this.graph))}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this._transmissionFactor=e._transmissionFactor,this.setTransmissionTexture(e.transmissionTexture?t(e.transmissionTexture.getChild()):null),this.transmissionTextureInfo.getChild().copy(t(e.transmissionTextureInfo.getChild()),t),this}dispose(){this.transmissionTextureInfo.getChild().dispose(),super.dispose()}getTransmissionFactor(){return this._transmissionFactor}setTransmissionFactor(e){return this._transmissionFactor=e,this}getTransmissionTexture(){return this.transmissionTexture?this.transmissionTexture.getChild():null}getTransmissionTextureInfo(){return this.transmissionTexture?this.transmissionTextureInfo.getChild():null}setTransmissionTexture(e){return this.transmissionTexture=this.graph.linkTexture("transmissionTexture",de,this,e),this}}me.EXTENSION_NAME="KHR_materials_transmission",i([r.GraphChild],me.prototype,"transmissionTexture",void 0),i([r.GraphChild],me.prototype,"transmissionTextureInfo",void 0);const xe="KHR_materials_transmission";class Te extends r.Extension{constructor(...e){super(...e),this.extensionName=xe}createTransmission(){return new me(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[xe]){const n=this.createTransmission();e.materials[r].setExtension(xe,n);const i=t.extensions[xe];if(void 0!==i.transmissionFactor&&n.setTransmissionFactor(i.transmissionFactor),void 0!==i.transmissionTexture){const t=i.transmissionTexture;n.setTransmissionTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getTransmissionTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach((s=>{const r=s.getExtension(xe);if(r){const n=e.materialIndexMap.get(s),i=t.json.materials[n];i.extensions=i.extensions||{};const o=i.extensions[xe]={transmissionFactor:r.getTransmissionFactor()};if(r.getTransmissionTexture()){const t=r.getTransmissionTexture(),s=r.getTransmissionTextureInfo();o.transmissionTexture=e.createTextureInfoDef(t,s)}}})),this}}Te.EXTENSION_NAME=xe;class ye extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="Unlit",this.parentTypes=[r.PropertyType.MATERIAL],this.extensionName="KHR_materials_unlit"}}ye.EXTENSION_NAME="KHR_materials_unlit";const Ee="KHR_materials_unlit";class be extends r.Extension{constructor(...e){super(...e),this.extensionName=Ee}createUnlit(){return new ye(this.doc.getGraph(),this)}read(e){return(e.jsonDoc.json.materials||[]).forEach(((t,s)=>{t.extensions&&t.extensions[Ee]&&e.materials[s].setExtension(Ee,this.createUnlit())})),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach((s=>{if(s.getExtension(Ee)){const r=e.materialIndexMap.get(s),n=t.json.materials[r];n.extensions=n.extensions||{},n.extensions[Ee]={}}})),this}}be.EXTENSION_NAME=Ee;class Ce extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="Mapping",this.parentTypes=["MappingList"],this.extensionName="KHR_materials_variants",this.material=null,this.variants=[]}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this.setMaterial(e.material?t(e.material.getChild()):null),this.clearGraphChildList(this.variants),e.variants.forEach((e=>this.addVariant(t(e.getChild())))),this}getMaterial(){return this.material?this.material.getChild():null}setMaterial(e){return this.material=this.graph.link("material",this,e),this}addVariant(e){const t=this.graph.link("variant",this,e);return this.addGraphChild(this.variants,t)}removeVariant(e){return this.removeGraphChild(this.variants,e)}listVariants(){return this.variants.map((e=>e.getChild()))}}Ce.EXTENSION_NAME="KHR_materials_variants",i([r.GraphChild],Ce.prototype,"material",void 0),i([r.GraphChildList],Ce.prototype,"variants",void 0);class _e extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="MappingList",this.parentTypes=[r.PropertyType.PRIMITIVE],this.extensionName="KHR_materials_variants",this.mappings=[]}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this.clearGraphChildList(this.mappings),e.mappings.forEach((e=>this.addMapping(t(e.getChild())))),this}addMapping(e){const t=this.graph.link("mapping",this,e);return this.addGraphChild(this.mappings,t)}removeMapping(e){return this.removeGraphChild(this.mappings,e)}listMappings(){return this.mappings.map((e=>e.getChild()))}}_e.EXTENSION_NAME="KHR_materials_variants",i([r.GraphChildList],_e.prototype,"mappings",void 0);class Ie extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="Variant",this.parentTypes=[r.PropertyType.ROOT,"MappingList"],this.extensionName="KHR_materials_variants"}}Ie.EXTENSION_NAME="KHR_materials_variants";const Ae="KHR_materials_variants";class Se extends r.Extension{constructor(...e){super(...e),this.extensionName=Ae}createMappingList(){return new _e(this.doc.getGraph(),this)}createVariant(e=""){return new Ie(this.doc.getGraph(),this).setName(e)}createMapping(){return new Ce(this.doc.getGraph(),this)}listVariants(){return Array.from(this.properties).filter((e=>e instanceof Ie))}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[Ae])return this;const s=(t.json.extensions[Ae].variants||[]).map((e=>this.createVariant().setName(e.name||"")));return(t.json.meshes||[]).forEach(((t,r)=>{const n=e.meshes[r];(t.primitives||[]).forEach(((t,r)=>{if(!t.extensions||!t.extensions[Ae])return;const i=this.createMappingList(),o=t.extensions[Ae];for(const n of o.mappings){const t=this.createMapping();void 0!==n.material&&t.setMaterial(e.materials[n.material]);for(const e of n.variants||[])t.addVariant(s[e]);i.addMapping(t)}n.listPrimitives()[r].setExtension(Ae,i)}))})),this}write(e){const t=e.jsonDoc,s=this.listVariants();if(!s.length)return this;const r=[],n=new Map;for(const i of s)n.set(i,r.length),r.push(e.createPropertyDef(i));for(const i of this.doc.getRoot().listMeshes()){const t=e.meshIndexMap.get(i);i.listPrimitives().forEach(((s,r)=>{const i=s.getExtension(Ae);if(!i)return;const o=e.jsonDoc.json.meshes[t].primitives[r],a=i.listMappings().map((t=>{const s=e.createPropertyDef(t),r=t.getMaterial();return r&&(s.material=e.materialIndexMap.get(r)),s.variants=t.listVariants().map((e=>n.get(e))),s}));o.extensions=o.extensions||{},o.extensions[Ae]={mappings:a}}))}return t.json.extensions=t.json.extensions||{},t.json.extensions[Ae]={variants:r},this}}Se.EXTENSION_NAME=Ae;const{G:ve}=r.TextureChannel;class Ne extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="Transmission",this.parentTypes=[r.PropertyType.MATERIAL],this.extensionName="KHR_materials_volume",this._thicknessFactor=0,this._attenuationDistance=1/0,this._attenuationColor=[1,1,1],this.thicknessTexture=null,this.thicknessTextureInfo=this.graph.link("thicknessTextureInfo",this,new r.TextureInfo(this.graph))}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this._thicknessFactor=e._thicknessFactor,this._attenuationDistance=e._attenuationDistance,this._attenuationColor=[...e._attenuationColor],this.setThicknessTexture(e.thicknessTexture?t(e.thicknessTexture.getChild()):null),this.thicknessTextureInfo.getChild().copy(t(e.thicknessTextureInfo.getChild()),t),this}dispose(){this.thicknessTextureInfo.getChild().dispose(),super.dispose()}getThicknessFactor(){return this._thicknessFactor}setThicknessFactor(e){return this._thicknessFactor=e,this}getThicknessTexture(){return this.thicknessTexture?this.thicknessTexture.getChild():null}getThicknessTextureInfo(){return this.thicknessTexture?this.thicknessTextureInfo.getChild():null}setThicknessTexture(e){return this.thicknessTexture=this.graph.linkTexture("thicknessTexture",ve,this,e),this}getAttenuationDistance(){return this._attenuationDistance}setAttenuationDistance(e){return this._attenuationDistance=e,this}getAttenuationColor(){return this._attenuationColor}setAttenuationColor(e){return this._attenuationColor=e,this}getAttenuationColorHex(){return r.ColorUtils.factorToHex(this._attenuationColor)}setAttenuationColorHex(e){return r.ColorUtils.hexToFactor(e,this._attenuationColor),this}}Ne.EXTENSION_NAME="KHR_materials_volume",i([r.GraphChild],Ne.prototype,"thicknessTexture",void 0),i([r.GraphChild],Ne.prototype,"thicknessTextureInfo",void 0);const we="KHR_materials_volume";class Re extends r.Extension{constructor(...e){super(...e),this.extensionName=we}createVolume(){return new Ne(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach(((t,r)=>{if(t.extensions&&t.extensions[we]){const n=this.createVolume();e.materials[r].setExtension(we,n);const i=t.extensions[we];if(void 0!==i.thicknessFactor&&n.setThicknessFactor(i.thicknessFactor),void 0!==i.attenuationDistance&&n.setAttenuationDistance(i.attenuationDistance),void 0!==i.attenuationColor&&n.setAttenuationColor(i.attenuationColor),void 0!==i.thicknessTexture){const t=i.thicknessTexture;n.setThicknessTexture(e.textures[s[t.index].source]),e.setTextureInfo(n.getThicknessTextureInfo(),t)}}})),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach((s=>{const n=s.getExtension(we);if(n){const i=e.materialIndexMap.get(s),o=t.json.materials[i];o.extensions=o.extensions||{};const a=o.extensions[we]={};if(n.getThicknessFactor()>0&&(a.thicknessFactor=n.getThicknessFactor()),Number.isFinite(n.getAttenuationDistance())&&(a.attenuationDistance=n.getAttenuationDistance()),r.MathUtils.eq(n.getAttenuationColor(),[1,1,1])||(a.attenuationColor=n.getAttenuationColor()),n.getThicknessTexture()){const t=n.getThicknessTexture(),s=n.getThicknessTextureInfo();a.thicknessTexture=e.createTextureInfoDef(t,s)}}})),this}}Re.EXTENSION_NAME=we;const Me="KHR_mesh_quantization";class Oe extends r.Extension{constructor(...e){super(...e),this.extensionName=Me}read(e){return this}write(e){return this}}Oe.EXTENSION_NAME=Me;const Ue="KHR_texture_basisu";class Fe{getSize(e){const t=Object(n.b)(new Uint8Array(e));return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=Object(n.b)(new Uint8Array(e)).dataFormatDescriptor[0];if(t.colorModel===n.a.ETC1S)return 2===t.samples.length&&15==(15&t.samples[1].channelID)?4:3;if(t.colorModel===n.a.UASTC)return 3==(15&t.samples[0].channelID)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getGPUByteLength(e){const t=Object(n.b)(new Uint8Array(e)),s=this.getChannels(e)>3;let r=0;for(let n=0;n<t.levels.length;n++){const e=t.levels[n];r+=e.uncompressedByteLength?e.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,n)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,n)))/4)*(s?16:8)}return r}}class Pe extends r.Extension{constructor(...e){super(...e),this.extensionName=Ue,this.prereadTypes=[r.PropertyType.TEXTURE]}static register(){r.ImageUtils.registerFormat("image/ktx2",new Fe)}preread(e){return e.jsonDoc.json.textures.forEach((e=>{e.extensions&&e.extensions[Ue]&&(e.source=e.extensions[Ue].source)})),this}read(e){return this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listTextures().forEach((s=>{if("image/ktx2"===s.getMimeType()){const r=e.imageIndexMap.get(s);t.json.textures.forEach((e=>{e.source===r&&(e.extensions=e.extensions||{},e.extensions[Ue]={source:e.source},delete e.source)}))}})),this}}Pe.EXTENSION_NAME=Ue;class Le extends r.ExtensionProperty{constructor(...e){super(...e),this.propertyType="Transform",this.parentTypes=[r.PropertyType.TEXTURE_INFO],this.extensionName="KHR_texture_transform",this._offset=[0,0],this._rotation=0,this._scale=[1,1],this._texCoord=null}copy(e,t=r.COPY_IDENTITY){return super.copy(e,t),this._offset=e._offset,this._rotation=e._rotation,this._scale=e._scale,this._texCoord=e._texCoord,this}getOffset(){return this._offset}setOffset(e){return this._offset=e,this}getRotation(){return this._rotation}setRotation(e){return this._rotation=e,this}getScale(){return this._scale}setScale(e){return this._scale=e,this}getTexCoord(){return this._texCoord}setTexCoord(e){return this._texCoord=e,this}}Le.EXTENSION_NAME="KHR_texture_transform";const je="KHR_texture_transform";class ke extends r.Extension{constructor(...e){super(...e),this.extensionName=je}createTransform(){return new Le(this.doc.getGraph(),this)}read(e){for(const[t,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions[je])continue;const e=this.createTransform(),r=s.extensions[je];void 0!==r.offset&&e.setOffset(r.offset),void 0!==r.rotation&&e.setRotation(r.rotation),void 0!==r.scale&&e.setScale(r.scale),void 0!==r.texCoord&&e.setTexCoord(r.texCoord),t.setExtension(je,e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[s,n]of t){const e=s.getExtension(je);if(!e)continue;n.extensions=n.extensions||{};const t={},i=r.MathUtils.eq;i(e.getOffset(),[0,0])||(t.offset=e.getOffset()),0!==e.getRotation()&&(t.rotation=e.getRotation()),i(e.getScale(),[1,1])||(t.scale=e.getScale()),null!=e.getTexCoord()&&(t.texCoord=e.getTexCoord()),n.extensions[je]=t}return this}}ke.EXTENSION_NAME=je;const De=[F,k,q,X,ee,ge,ae,Te,be,Se,Re,Oe,Pe,ke],Ge=[c,f,m,...De]},ZaHm:function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"c",(function(){return i})),s.d(t,"b",(function(){return o}));var r=s("yU0y");function n(e){var t=e[0],s=e[1],r=e[2],n=e[3],i=e[4],o=e[5],a=e[6],c=e[7],u=e[8],h=e[9],l=e[10],p=e[11],f=e[12],g=e[13],d=e[14],m=e[15];return(t*o-s*i)*(l*m-p*d)-(t*a-r*i)*(h*m-p*g)+(t*c-n*i)*(h*d-l*g)+(s*a-r*o)*(u*m-p*f)-(s*c-n*o)*(u*d-l*f)+(r*c-n*a)*(u*g-h*f)}function i(e,t,s){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],c=t[5],u=t[6],h=t[7],l=t[8],p=t[9],f=t[10],g=t[11],d=t[12],m=t[13],x=t[14],T=t[15],y=s[0],E=s[1],b=s[2],C=s[3];return e[0]=y*r+E*a+b*l+C*d,e[1]=y*n+E*c+b*p+C*m,e[2]=y*i+E*u+b*f+C*x,e[3]=y*o+E*h+b*g+C*T,y=s[4],E=s[5],b=s[6],C=s[7],e[4]=y*r+E*a+b*l+C*d,e[5]=y*n+E*c+b*p+C*m,e[6]=y*i+E*u+b*f+C*x,e[7]=y*o+E*h+b*g+C*T,y=s[8],E=s[9],b=s[10],C=s[11],e[8]=y*r+E*a+b*l+C*d,e[9]=y*n+E*c+b*p+C*m,e[10]=y*i+E*u+b*f+C*x,e[11]=y*o+E*h+b*g+C*T,y=s[12],E=s[13],b=s[14],C=s[15],e[12]=y*r+E*a+b*l+C*d,e[13]=y*n+E*c+b*p+C*m,e[14]=y*i+E*u+b*f+C*x,e[15]=y*o+E*h+b*g+C*T,e}function o(e,t){var s=new r.a(3);!function(e,t){var s=t[0],r=t[1],n=t[2],i=t[4],o=t[5],a=t[6],c=t[8],u=t[9],h=t[10];e[0]=Math.hypot(s,r,n),e[1]=Math.hypot(i,o,a),e[2]=Math.hypot(c,u,h)}(s,t);var n=1/s[0],i=1/s[1],o=1/s[2],a=t[0]*n,c=t[1]*i,u=t[2]*o,h=t[4]*n,l=t[5]*i,p=t[6]*o,f=t[8]*n,g=t[9]*i,d=t[10]*o,m=a+l+d,x=0;return m>0?(x=2*Math.sqrt(m+1),e[3]=.25*x,e[0]=(p-g)/x,e[1]=(f-u)/x,e[2]=(c-h)/x):a>l&&a>d?(x=2*Math.sqrt(1+a-l-d),e[3]=(p-g)/x,e[0]=.25*x,e[1]=(c+h)/x,e[2]=(f+u)/x):l>d?(x=2*Math.sqrt(1+l-a-d),e[3]=(f-u)/x,e[0]=(c+h)/x,e[1]=.25*x,e[2]=(p+g)/x):(x=2*Math.sqrt(1+d-a-l),e[3]=(c-h)/x,e[0]=(f+u)/x,e[1]=(p+g)/x,e[2]=.25*x),e}},aUfK:function(e,t,s){"use strict";s.d(t,"a",(function(){return p})),s.d(t,"b",(function(){return l}));var r=s("eN3O"),n=s("q1tI"),i=s.n(n),o=s("MTMm"),a=s("EXCG"),c=s("Np9n"),u=Object(n.createContext)(null);function h(){var e=Object(n.useContext)(u);if(null===e){var t=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(t,h),t}return e}function l(){var e=Object(n.useState)([]),t=e[0],s=e[1];return[t.length>0?t.join(" "):void 0,Object(n.useMemo)((function(){return function(e){var t=Object(n.useCallback)((function(e){return s((function(t){return[].concat(t,[e])})),function(){return s((function(t){var s=t.slice(),r=s.indexOf(e);return-1!==r&&s.splice(r,1),s}))}}),[]),r=Object(n.useMemo)((function(){return{register:t,slot:e.slot,name:e.name,props:e.props}}),[t,e.slot,e.name,e.props]);return i.a.createElement(u.Provider,{value:r},e.children)}}),[s])]}function p(e){var t=h(),s="headlessui-description-"+Object(c.a)();Object(a.a)((function(){return t.register(s)}),[s,t.register]);var n=e,i=Object(r.b)({},t.props,{id:s});return Object(o.d)({props:Object(r.b)({},n,i),slot:t.slot||{},defaultTag:"p",name:t.name||"Description"})}},"n+fv":function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return i}));var r=s("yU0y");function n(e){var t=e[0],s=e[1],r=e[2];return Math.hypot(t,s,r)}function i(e,t,s){var r=t[0],n=t[1],i=t[2],o=s[3]*r+s[7]*n+s[11]*i+s[15];return o=o||1,e[0]=(s[0]*r+s[4]*n+s[8]*i+s[12])/o,e[1]=(s[1]*r+s[5]*n+s[9]*i+s[13])/o,e[2]=(s[2]*r+s[6]*n+s[10]*i+s[14])/o,e}!function(){var e=function(){var e=new r.a(3);return r.a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}()}()},noPr:function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return d}));new Uint8Array([0]);const r=[171,75,84,88,32,50,48,187,13,10,26,10];var n,i,o,a,c,u,h,l;!function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"}(n||(n={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(i||(i={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(o||(o={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(a||(a={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(c||(c={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(u||(u={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(h||(h={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(l||(l={}));class p{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=n.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:i.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:o.UNSPECIFIED,colorPrimaries:a.SRGB,transferFunction:a.SRGB,flags:u.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null}}class f{constructor(e,t,s,r){this._dataView=new DataView(e.buffer,e.byteOffset+t,s),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const s=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,r)}}function g(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):e.from(t).toString("utf8")}function d(e){const t=new Uint8Array(e.buffer,e.byteOffset,r.length);if(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||t[4]!==r[4]||t[5]!==r[5]||t[6]!==r[6]||t[7]!==r[7]||t[8]!==r[8]||t[9]!==r[9]||t[10]!==r[10]||t[11]!==r[11])throw new Error("Missing KTX 2.0 identifier.");const s=new p,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new f(e,r.length,n,!0);s.vkFormat=i._nextUint32(),s.typeSize=i._nextUint32(),s.pixelWidth=i._nextUint32(),s.pixelHeight=i._nextUint32(),s.pixelDepth=i._nextUint32(),s.layerCount=i._nextUint32(),s.faceCount=i._nextUint32();const o=i._nextUint32();s.supercompressionScheme=i._nextUint32();const a=i._nextUint32(),c=i._nextUint32(),u=i._nextUint32(),h=i._nextUint32(),l=i._nextUint64(),d=i._nextUint64(),m=new f(e,r.length+n,3*o*8,!0);for(let r=0;r<o;r++)s.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+m._nextUint64(),m._nextUint64()),uncompressedByteLength:m._nextUint64()});const x=new f(e,a,c,!0),T={vendorId:x._skip(4)._nextUint16(),descriptorType:x._nextUint16(),versionNumber:x._nextUint16(),descriptorBlockSize:x._nextUint16(),colorModel:x._nextUint8(),colorPrimaries:x._nextUint8(),transferFunction:x._nextUint8(),flags:x._nextUint8(),texelBlockDimension:{x:x._nextUint8()+1,y:x._nextUint8()+1,z:x._nextUint8()+1,w:x._nextUint8()+1},bytesPlane:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],samples:[]},y=(T.descriptorBlockSize/4-6)/4;for(let r=0;r<y;r++)T.samples[r]={bitOffset:x._nextUint16(),bitLength:x._nextUint8(),channelID:x._nextUint8(),samplePosition:[x._nextUint8(),x._nextUint8(),x._nextUint8(),x._nextUint8()],sampleLower:x._nextUint32(),sampleUpper:x._nextUint32()};s.dataFormatDescriptor.length=0,s.dataFormatDescriptor.push(T);const E=new f(e,u,h,!0);for(;E._offset<h;){const e=E._nextUint32(),t=E._scan(e),r=g(t),n=E._scan(e-t.byteLength);s.keyValue[r]=r.match(/^ktx/i)?g(n):n,E._offset%4&&E._skip(4-E._offset%4)}if(d<=0)return s;const b=new f(e,l,d,!0),C=b._nextUint16(),_=b._nextUint16(),I=b._nextUint32(),A=b._nextUint32(),S=b._nextUint32(),v=b._nextUint32(),N=[];for(let r=0;r<o;r++)N.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const w=l+b._offset,R=w+I,M=R+A,O=M+S,U=new Uint8Array(e.buffer,e.byteOffset+w,I),F=new Uint8Array(e.buffer,e.byteOffset+R,A),P=new Uint8Array(e.buffer,e.byteOffset+M,S),L=new Uint8Array(e.buffer,e.byteOffset+O,v);return s.globalData={endpointCount:C,selectorCount:_,imageDescs:N,endpointsData:U,selectorsData:F,tablesData:P,extendedData:L},s}}).call(this,s("HDXh").Buffer)},tbvF:function(e,t,s){var r=s("IDFI"),n=s("z8cS"),i="undefined"!==typeof Float64Array;function o(e,t){return e[0]-t[0]}function a(){var e,t=this.stride,s=new Array(t.length);for(e=0;e<s.length;++e)s[e]=[Math.abs(t[e]),e];s.sort(o);var r=new Array(s.length);for(e=0;e<r.length;++e)r[e]=s[e][1];return r}function c(e,t){var s=["View",t,"d",e].join("");t<0&&(s="View_Nil"+e);var n="generic"===e;if(-1===t){var i="function "+s+"(a){this.data=a;};var proto="+s+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+s+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+s+"(a){return new "+s+"(a);}";return new Function(i)()}if(0===t){i="function "+s+"(a,d) {this.data = a;this.offset = d};var proto="+s+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+s+"_copy() {return new "+s+"(this.data,this.offset)};proto.pick=function "+s+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+s+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+s+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+s+"(a,b,c,d){return new "+s+"(a,d)}";return new Function("TrivialArray",i)(u[e][0])}i=["'use strict'"];var o=r(t),c=o.map((function(e){return"i"+e})),h="this.offset+"+o.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),l=o.map((function(e){return"b"+e})).join(","),p=o.map((function(e){return"c"+e})).join(",");i.push("function "+s+"(a,"+l+","+p+",d){this.data=a","this.shape=["+l+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+s+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+s+"_size(){return "+o.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+s+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+s+"_set("+c.join(",")+",v){"),n?i.push("return this.data.set("+h+",v)}"):i.push("return this.data["+h+"]=v}"),i.push("proto.get=function "+s+"_get("+c.join(",")+"){"),n?i.push("return this.data.get("+h+")}"):i.push("return this.data["+h+"]}"),i.push("proto.index=function "+s+"_index(",c.join(),"){return "+h+"}"),i.push("proto.hi=function "+s+"_hi("+c.join(",")+"){return new "+s+"(this.data,"+o.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+o.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var f=o.map((function(e){return"a"+e+"=this.shape["+e+"]"})),g=o.map((function(e){return"c"+e+"=this.stride["+e+"]"}));i.push("proto.lo=function "+s+"_lo("+c.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+g.join(","));for(var d=0;d<t;++d)i.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}");i.push("return new "+s+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"c"+e})).join(",")+",b)}"),i.push("proto.step=function "+s+"_step("+c.join(",")+"){var "+o.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+o.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(d=0;d<t;++d)i.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}");i.push("return new "+s+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"b"+e})).join(",")+",c)}");var m=new Array(t),x=new Array(t);for(d=0;d<t;++d)m[d]="a[i"+d+"]",x[d]="b[i"+d+"]";i.push("proto.transpose=function "+s+"_transpose("+c+"){"+c.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+s+"(this.data,"+m.join(",")+","+x.join(",")+",this.offset)}"),i.push("proto.pick=function "+s+"_pick("+c+"){var a=[],b=[],c=this.offset");for(d=0;d<t;++d)i.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+s+"(data,shape,stride,offset){return new "+s+"(data,"+o.map((function(e){return"shape["+e+"]"})).join(",")+","+o.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(u[e],a)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,s,r){if(void 0===e)return(0,u.array[0])([]);"number"===typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var o=t.length;if(void 0===s){s=new Array(o);for(var a=o-1,h=1;a>=0;--a)s[a]=h,h*=t[a]}if(void 0===r){r=0;for(a=0;a<o;++a)s[a]<0&&(r-=(t[a]-1)*s[a])}for(var l=function(e){if(n(e))return"buffer";if(i)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),p=u[l];p.length<=o+1;)p.push(c(l,p.length-1));return(0,p[o+1])(e,t,s,r)}},yU0y:function(e,t,s){"use strict";s.d(t,"b",(function(){return r})),s.d(t,"a",(function(){return n})),s.d(t,"c",(function(){return i}));var r=1e-6,n="undefined"!==typeof Float32Array?Float32Array:Array,i=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)})},z8cS:function(e,t){function s(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(s(e)||function(e){return"function"===typeof e.readFloatLE&&"function"===typeof e.slice&&s(e.slice(0,0))}(e)||!!e._isBuffer)}}}]);